var eo=Object.defineProperty,to=Object.defineProperties;var no=Object.getOwnPropertyDescriptors;var Ht=Object.getOwnPropertySymbols;var Vi=Object.prototype.hasOwnProperty,Wi=Object.prototype.propertyIsEnumerable;var Oi=(n,e,t)=>e in n?eo(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,z=(n,e)=>{for(var t in e||(e={}))Vi.call(e,t)&&Oi(n,t,e[t]);if(Ht)for(var t of Ht(e))Wi.call(e,t)&&Oi(n,t,e[t]);return n},Q=(n,e)=>to(n,no(e));var nt=(n,e)=>{var t={};for(var i in n)Vi.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&Ht)for(var i of Ht(n))e.indexOf(i)<0&&Wi.call(n,i)&&(t[i]=n[i]);return t};import{get as Di,set as io}from"lodash";var xn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(i=>typeof i=="object"?JSON.stringify(i):i).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},_i={},ro={};function pe(n){let e=Di(_i,n);if(!e){let t=Di(ro,n);e=new xn({name:n,logLevel:t}),io(_i,n,e)}return e}import{PublicKey as wt,sendAndConfirmTransaction as jn,SystemProgram as Cs,Transaction as Vt,TransactionMessage as Wt,VersionedTransaction as Dt}from"@solana/web3.js";import Ks from"axios";import{PublicKey as zn,AddressLookupTableAccount as Pt}from"@solana/web3.js";import{PublicKey as Ss}from"@solana/web3.js";import ve from"bn.js";var dt=9e15,Ze=1e9,In="0123456789abcdef",Zt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",jt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Sn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-dt,maxE:dt,crypto:!1},Xi,De,U=!0,Jt="[DecimalError] ",Ye=Jt+"Invalid argument: ",zi=Jt+"Precision limit exceeded",Hi=Jt+"crypto unavailable",Yi="[object Decimal]",fe=Math.floor,ce=Math.pow,oo=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,so=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,ao=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Zi=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ne=1e7,_=7,uo=9007199254740991,co=Zt.length-1,Cn=jt.length-1,T={toStringTag:Yi};T.absoluteValue=T.abs=function(){var n=new this.constructor(this);return n.s<0&&(n.s=1),E(n)};T.ceil=function(){return E(new this.constructor(this),this.e+1,2)};T.clampedTo=T.clamp=function(n,e){var t,i=this,r=i.constructor;if(n=new r(n),e=new r(e),!n.s||!e.s)return new r(NaN);if(n.gt(e))throw Error(Ye+e);return t=i.cmp(n),t<0?n:i.cmp(e)>0?e:new r(i)};T.comparedTo=T.cmp=function(n){var e,t,i,r,o=this,s=o.d,a=(n=new o.constructor(n)).d,c=o.s,u=n.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==n.e)return o.e>n.e^c<0?1:-1;for(i=s.length,r=a.length,e=0,t=i<r?i:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return i===r?0:i>r^c<0?1:-1};T.cosine=T.cos=function(){var n,e,t=this,i=t.constructor;return t.d?t.d[0]?(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+_,i.rounding=1,t=lo(i,er(i,t)),i.precision=n,i.rounding=e,E(De==2||De==3?t.neg():t,n,e,!0)):new i(1):new i(NaN)};T.cubeRoot=T.cbrt=function(){var n,e,t,i,r,o,s,a,c,u,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(U=!1,o=l.s*ce(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=me(l.d),n=l.e,(o=(n-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ce(t,1/3),n=fe((n+1)/3)-(n%3==(n<0?-1:2)),o==1/0?t="5e"+n:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+n),i=new m(t),i.s=l.s):i=new m(o.toString()),s=(n=m.precision)+3;;)if(a=i,c=a.times(a).times(a),u=c.plus(l),i=ee(u.plus(l).times(a),u.plus(c),s+2,1),me(a.d).slice(0,s)===(t=me(i.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(E(a,n+1,0),a.times(a).times(a).eq(l))){i=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(E(i,n+1,1),e=!i.times(i).times(i).eq(l));break}return U=!0,E(i,n,m.rounding,e)};T.decimalPlaces=T.dp=function(){var n,e=this.d,t=NaN;if(e){if(n=e.length-1,t=(n-fe(this.e/_))*_,n=e[n],n)for(;n%10==0;n/=10)t--;t<0&&(t=0)}return t};T.dividedBy=T.div=function(n){return ee(this,new this.constructor(n))};T.dividedToIntegerBy=T.divToInt=function(n){var e=this,t=e.constructor;return E(ee(e,new t(n),0,1,1),t.precision,t.rounding)};T.equals=T.eq=function(n){return this.cmp(n)===0};T.floor=function(){return E(new this.constructor(this),this.e+1,3)};T.greaterThan=T.gt=function(n){return this.cmp(n)>0};T.greaterThanOrEqualTo=T.gte=function(n){var e=this.cmp(n);return e==1||e===0};T.hyperbolicCosine=T.cosh=function(){var n,e,t,i,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,i=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(n=Math.ceil(r/3),e=(1/en(4,n)).toString()):(n=16,e="2.3283064365386962890625e-10"),o=pt(s,1,o.times(e),new s(1),!0);for(var c,u=n,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return E(o,s.precision=t,s.rounding=i,!0)};T.hyperbolicSine=T.sinh=function(){var n,e,t,i,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,i=r.d.length,i<3)r=pt(o,2,r,r,!0);else{n=1.4*Math.sqrt(i),n=n>16?16:n|0,r=r.times(1/en(5,n)),r=pt(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);n--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,E(r,e,t,!0)};T.hyperbolicTangent=T.tanh=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+7,i.rounding=1,ee(t.sinh(),t.cosh(),i.precision=n,i.rounding=e)):new i(t.s)};T.inverseCosine=T.acos=function(){var n,e=this,t=e.constructor,i=e.abs().cmp(1),r=t.precision,o=t.rounding;return i!==-1?i===0?e.isNeg()?Ke(t,r,o):new t(0):new t(NaN):e.isZero()?Ke(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),n=Ke(t,r+4,o).times(.5),t.precision=r,t.rounding=o,n.minus(e))};T.inverseHyperbolicCosine=T.acosh=function(){var n,e,t=this,i=t.constructor;return t.lte(1)?new i(t.eq(1)?0:NaN):t.isFinite()?(n=i.precision,e=i.rounding,i.precision=n+Math.max(Math.abs(t.e),t.sd())+4,i.rounding=1,U=!1,t=t.times(t).minus(1).sqrt().plus(t),U=!0,i.precision=n,i.rounding=e,t.ln()):new i(t)};T.inverseHyperbolicSine=T.asinh=function(){var n,e,t=this,i=t.constructor;return!t.isFinite()||t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+2*Math.max(Math.abs(t.e),t.sd())+6,i.rounding=1,U=!1,t=t.times(t).plus(1).sqrt().plus(t),U=!0,i.precision=n,i.rounding=e,t.ln())};T.inverseHyperbolicTangent=T.atanh=function(){var n,e,t,i,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(n=o.precision,e=o.rounding,i=r.sd(),Math.max(i,n)<2*-r.e-1?E(new o(r),n,e,!0):(o.precision=t=i-r.e,r=ee(r.plus(1),new o(1).minus(r),t+n,1),o.precision=n+4,o.rounding=1,r=r.ln(),o.precision=n,o.rounding=e,r.times(.5))):new o(NaN)};T.inverseSine=T.asin=function(){var n,e,t,i,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,i=o.rounding,e!==-1?e===0?(n=Ke(o,t+4,i).times(.5),n.s=r.s,n):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=i,r.times(2)))};T.inverseTangent=T.atan=function(){var n,e,t,i,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&m+4<=Cn)return s=Ke(l,m+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(m+4<=Cn)return s=Ke(l,m+4,d).times(.5),s.s=u.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/_+2|0),n=t;n;--n)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(U=!1,e=Math.ceil(a/_),i=1,c=u.times(u),s=new l(u),r=u;n!==-1;)if(r=r.times(c),o=s.minus(r.div(i+=2)),r=r.times(c),s=o.plus(r.div(i+=2)),s.d[e]!==void 0)for(n=e;s.d[n]===o.d[n]&&n--;);return t&&(s=s.times(2<<t-1)),U=!0,E(s,l.precision=m,l.rounding=d,!0)};T.isFinite=function(){return!!this.d};T.isInteger=T.isInt=function(){return!!this.d&&fe(this.e/_)>this.d.length-2};T.isNaN=function(){return!this.s};T.isNegative=T.isNeg=function(){return this.s<0};T.isPositive=T.isPos=function(){return this.s>0};T.isZero=function(){return!!this.d&&this.d[0]===0};T.lessThan=T.lt=function(n){return this.cmp(n)<0};T.lessThanOrEqualTo=T.lte=function(n){return this.cmp(n)<1};T.logarithm=T.log=function(n){var e,t,i,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding,p=5;if(n==null)n=new l(10),e=!0;else{if(n=new l(n),t=n.d,n.s<0||!t||!t[0]||n.eq(1))return new l(NaN);e=n.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(U=!1,a=m+p,s=He(u,a),i=e?Qt(l,a+10):He(n,a),c=ee(s,i,a,1),Ct(c.d,r=m,d))do if(a+=10,s=He(u,a),i=e?Qt(l,a+10):He(n,a),c=ee(s,i,a,1),!o){+me(c.d).slice(r+1,r+15)+1==1e14&&(c=E(c,m+1,0));break}while(Ct(c.d,r+=10,d));return U=!0,E(c,m,d)};T.minus=T.sub=function(n){var e,t,i,r,o,s,a,c,u,l,m,d,p=this,f=p.constructor;if(n=new f(n),!p.d||!n.d)return!p.s||!n.s?n=new f(NaN):p.d?n.s=-n.s:n=new f(n.d||p.s!==n.s?p:NaN),n;if(p.s!=n.s)return n.s=-n.s,p.plus(n);if(u=p.d,d=n.d,a=f.precision,c=f.rounding,!u[0]||!d[0]){if(d[0])n.s=-n.s;else if(u[0])n=new f(p);else return new f(c===3?-0:0);return U?E(n,a,c):n}if(t=fe(n.e/_),l=fe(p.e/_),u=u.slice(),o=l-t,o){for(m=o<0,m?(e=u,o=-o,s=d.length):(e=d,t=l,s=u.length),i=Math.max(Math.ceil(a/_),s)+2,o>i&&(o=i,e.length=1),e.reverse(),i=o;i--;)e.push(0);e.reverse()}else{for(i=u.length,s=d.length,m=i<s,m&&(s=i),i=0;i<s;i++)if(u[i]!=d[i]){m=u[i]<d[i];break}o=0}for(m&&(e=u,u=d,d=e,n.s=-n.s),s=u.length,i=d.length-s;i>0;--i)u[s++]=0;for(i=d.length;i>o;){if(u[--i]<d[i]){for(r=i;r&&u[--r]===0;)u[r]=Ne-1;--u[r],u[i]+=Ne}u[i]-=d[i]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(n.d=u,n.e=$t(u,t),U?E(n,a,c):n):new f(c===3?-0:0)};T.modulo=T.mod=function(n){var e,t=this,i=t.constructor;return n=new i(n),!t.d||!n.s||n.d&&!n.d[0]?new i(NaN):!n.d||t.d&&!t.d[0]?E(new i(t),i.precision,i.rounding):(U=!1,i.modulo==9?(e=ee(t,n.abs(),0,3,1),e.s*=n.s):e=ee(t,n,0,i.modulo,1),e=e.times(n),U=!0,t.minus(e))};T.naturalExponential=T.exp=function(){return Kn(this)};T.naturalLogarithm=T.ln=function(){return He(this)};T.negated=T.neg=function(){var n=new this.constructor(this);return n.s=-n.s,E(n)};T.plus=T.add=function(n){var e,t,i,r,o,s,a,c,u,l,m=this,d=m.constructor;if(n=new d(n),!m.d||!n.d)return!m.s||!n.s?n=new d(NaN):m.d||(n=new d(n.d||m.s===n.s?m:NaN)),n;if(m.s!=n.s)return n.s=-n.s,m.minus(n);if(u=m.d,l=n.d,a=d.precision,c=d.rounding,!u[0]||!l[0])return l[0]||(n=new d(m)),U?E(n,a,c):n;if(o=fe(m.e/_),i=fe(n.e/_),u=u.slice(),r=o-i,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,i=o,s=u.length),o=Math.ceil(a/_),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/Ne|0,u[r]%=Ne;for(e&&(u.unshift(e),++i),s=u.length;u[--s]==0;)u.pop();return n.d=u,n.e=$t(u,i),U?E(n,a,c):n};T.precision=T.sd=function(n){var e,t=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(Ye+n);return t.d?(e=ji(t.d),n&&t.e+1>e&&(e=t.e+1)):e=NaN,e};T.round=function(){var n=this,e=n.constructor;return E(new e(n),n.e+1,e.rounding)};T.sine=T.sin=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+_,i.rounding=1,t=po(i,er(i,t)),i.precision=n,i.rounding=e,E(De>2?t.neg():t,n,e,!0)):new i(NaN)};T.squareRoot=T.sqrt=function(){var n,e,t,i,r,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(U=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=me(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=fe((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),i=new l(e)):i=new l(u.toString()),t=(c=l.precision)+3;;)if(o=i,i=o.plus(ee(s,o,t+2,1)).times(.5),me(o.d).slice(0,t)===(e=me(i.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(E(o,c+1,0),o.times(o).eq(s))){i=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(E(i,c+1,1),n=!i.times(i).eq(s));break}return U=!0,E(i,c,l.rounding,n)};T.tangent=T.tan=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+10,i.rounding=1,t=t.sin(),t.s=1,t=ee(t,new i(1).minus(t.times(t)).sqrt(),n+10,0),i.precision=n,i.rounding=e,E(De==2||De==4?t.neg():t,n,e,!0)):new i(NaN)};T.times=T.mul=function(n){var e,t,i,r,o,s,a,c,u,l=this,m=l.constructor,d=l.d,p=(n=new m(n)).d;if(n.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!n.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?n.s/0:n.s*0);for(t=fe(l.e/_)+fe(n.e/_),c=d.length,u=p.length,c<u&&(o=d,d=p,p=o,s=c,c=u,u=s),o=[],s=c+u,i=s;i--;)o.push(0);for(i=u;--i>=0;){for(e=0,r=c+i;r>i;)a=o[r]+p[i]*d[r-i-1]+e,o[r--]=a%Ne|0,e=a/Ne|0;o[r]=(o[r]+e)%Ne|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),n.d=o,n.e=$t(o,t),U?E(n,m.precision,m.rounding):n};T.toBinary=function(n,e){return Rn(this,2,n,e)};T.toDecimalPlaces=T.toDP=function(n,e){var t=this,i=t.constructor;return t=new i(t),n===void 0?t:(Pe(n,0,Ze),e===void 0?e=i.rounding:Pe(e,0,8),E(t,n+t.e+1,e))};T.toExponential=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=Fe(i,!0):(Pe(n,0,Ze),e===void 0?e=r.rounding:Pe(e,0,8),i=E(new r(i),n+1,e),t=Fe(i,!0,n+1)),i.isNeg()&&!i.isZero()?"-"+t:t};T.toFixed=function(n,e){var t,i,r=this,o=r.constructor;return n===void 0?t=Fe(r):(Pe(n,0,Ze),e===void 0?e=o.rounding:Pe(e,0,8),i=E(new o(r),n+r.e+1,e),t=Fe(i,!1,n+i.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};T.toFraction=function(n){var e,t,i,r,o,s,a,c,u,l,m,d,p=this,f=p.d,b=p.constructor;if(!f)return new b(p);if(u=t=new b(1),i=c=new b(0),e=new b(i),o=e.e=ji(f)-p.e-1,s=o%_,e.d[0]=ce(10,s<0?_+s:s),n==null)n=o>0?e:u;else{if(a=new b(n),!a.isInt()||a.lt(u))throw Error(Ye+a);n=a.gt(e)?o>0?e:u:a}for(U=!1,a=new b(me(f)),l=b.precision,b.precision=o=f.length*_*2;m=ee(a,e,0,1,1),r=t.plus(m.times(i)),r.cmp(n)!=1;)t=i,i=r,r=u,u=c.plus(m.times(r)),c=r,r=e,e=a.minus(m.times(r)),a=r;return r=ee(n.minus(t),i,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(i)),c.s=u.s=p.s,d=ee(u,i,o,1).minus(p).abs().cmp(ee(c,t,o,1).minus(p).abs())<1?[u,i]:[c,t],b.precision=l,U=!0,d};T.toHexadecimal=T.toHex=function(n,e){return Rn(this,16,n,e)};T.toNearest=function(n,e){var t=this,i=t.constructor;if(t=new i(t),n==null){if(!t.d)return t;n=new i(1),e=i.rounding}else{if(n=new i(n),e===void 0?e=i.rounding:Pe(e,0,8),!t.d)return n.s?t:n;if(!n.d)return n.s&&(n.s=t.s),n}return n.d[0]?(U=!1,t=ee(t,n,0,e,1).times(n),U=!0,E(t)):(n.s=t.s,t=n),t};T.toNumber=function(){return+this};T.toOctal=function(n,e){return Rn(this,8,n,e)};T.toPower=T.pow=function(n){var e,t,i,r,o,s,a=this,c=a.constructor,u=+(n=new c(n));if(!a.d||!n.d||!a.d[0]||!n.d[0])return new c(ce(+a,u));if(a=new c(a),a.eq(1))return a;if(i=c.precision,o=c.rounding,n.eq(1))return E(a,i,o);if(e=fe(n.e/_),e>=n.d.length-1&&(t=u<0?-u:u)<=uo)return r=Qi(c,a,t,i),n.s<0?new c(1).div(r):E(r,i,o);if(s=a.s,s<0){if(e<n.d.length-1)return new c(NaN);if((n.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ce(+a,u),e=t==0||!isFinite(t)?fe(u*(Math.log("0."+me(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(U=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=Kn(n.times(He(a,i+t)),i),r.d&&(r=E(r,i+5,1),Ct(r.d,i,o)&&(e=i+10,r=E(Kn(n.times(He(a,e+t)),e),e+5,1),+me(r.d).slice(i+1,i+15)+1==1e14&&(r=E(r,i+1,0)))),r.s=s,U=!0,c.rounding=o,E(r,i,o))};T.toPrecision=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=Fe(i,i.e<=r.toExpNeg||i.e>=r.toExpPos):(Pe(n,1,Ze),e===void 0?e=r.rounding:Pe(e,0,8),i=E(new r(i),n,e),t=Fe(i,n<=i.e||i.e<=r.toExpNeg,n)),i.isNeg()&&!i.isZero()?"-"+t:t};T.toSignificantDigits=T.toSD=function(n,e){var t=this,i=t.constructor;return n===void 0?(n=i.precision,e=i.rounding):(Pe(n,1,Ze),e===void 0?e=i.rounding:Pe(e,0,8)),E(new i(t),n,e)};T.toString=function(){var n=this,e=n.constructor,t=Fe(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()&&!n.isZero()?"-"+t:t};T.truncated=T.trunc=function(){return E(new this.constructor(this),this.e+1,1)};T.valueOf=T.toJSON=function(){var n=this,e=n.constructor,t=Fe(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()?"-"+t:t};function me(n){var e,t,i,r=n.length-1,o="",s=n[0];if(r>0){for(o+=s,e=1;e<r;e++)i=n[e]+"",t=_-i.length,t&&(o+=ze(t)),o+=i;s=n[e],i=s+"",t=_-i.length,t&&(o+=ze(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Pe(n,e,t){if(n!==~~n||n<e||n>t)throw Error(Ye+n)}function Ct(n,e,t,i){var r,o,s,a;for(o=n[0];o>=10;o/=10)--e;return--e<0?(e+=_,r=0):(r=Math.ceil((e+1)/_),e%=_),o=ce(10,_-e),a=n[r]%o|0,i==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(n[r+1]/o/100|0)==ce(10,e-2)-1||(a==o/2||a==0)&&(n[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(i||t<4)&&a==9999||!i&&t>3&&a==4999):s=((i||t<4)&&a+1==o||!i&&t>3&&a+1==o/2)&&(n[r+1]/o/1e3|0)==ce(10,e-3)-1,s}function Yt(n,e,t){for(var i,r=[0],o,s=0,a=n.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=In.indexOf(n.charAt(s++)),i=0;i<r.length;i++)r[i]>t-1&&(r[i+1]===void 0&&(r[i+1]=0),r[i+1]+=r[i]/t|0,r[i]%=t)}return r.reverse()}function lo(n,e){var t,i,r;if(e.isZero())return e;i=e.d.length,i<32?(t=Math.ceil(i/3),r=(1/en(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),n.precision+=t,e=pt(n,1,e.times(r),new n(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return n.precision-=t,e}var ee=function(){function n(i,r,o){var s,a=0,c=i.length;for(i=i.slice();c--;)s=i[c]*r+a,i[c]=s%o|0,a=s/o|0;return a&&i.unshift(a),i}function e(i,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(i[a]!=r[a]){c=i[a]>r[a]?1:-1;break}return c}function t(i,r,o,s){for(var a=0;o--;)i[o]-=a,a=i[o]<r[o]?1:0,i[o]=a*s+i[o]-r[o];for(;!i[0]&&i.length>1;)i.shift()}return function(i,r,o,s,a,c){var u,l,m,d,p,f,b,g,k,w,h,A,P,B,K,I,N,R,v,S,q=i.constructor,H=i.s==r.s?1:-1,x=i.d,C=r.d;if(!x||!x[0]||!C||!C[0])return new q(!i.s||!r.s||(x?C&&x[0]==C[0]:!C)?NaN:x&&x[0]==0||!C?H*0:H/0);for(c?(p=1,l=i.e-r.e):(c=Ne,p=_,l=fe(i.e/p)-fe(r.e/p)),v=C.length,N=x.length,k=new q(H),w=k.d=[],m=0;C[m]==(x[m]||0);m++);if(C[m]>(x[m]||0)&&l--,o==null?(B=o=q.precision,s=q.rounding):a?B=o+(i.e-r.e)+1:B=o,B<0)w.push(1),f=!0;else{if(B=B/p+2|0,m=0,v==1){for(d=0,C=C[0],B++;(m<N||d)&&B--;m++)K=d*c+(x[m]||0),w[m]=K/C|0,d=K%C|0;f=d||m<N}else{for(d=c/(C[0]+1)|0,d>1&&(C=n(C,d,c),x=n(x,d,c),v=C.length,N=x.length),I=v,h=x.slice(0,v),A=h.length;A<v;)h[A++]=0;S=C.slice(),S.unshift(0),R=C[0],C[1]>=c/2&&++R;do d=0,u=e(C,h,v,A),u<0?(P=h[0],v!=A&&(P=P*c+(h[1]||0)),d=P/R|0,d>1?(d>=c&&(d=c-1),b=n(C,d,c),g=b.length,A=h.length,u=e(b,h,g,A),u==1&&(d--,t(b,v<g?S:C,g,c))):(d==0&&(u=d=1),b=C.slice()),g=b.length,g<A&&b.unshift(0),t(h,b,A,c),u==-1&&(A=h.length,u=e(C,h,v,A),u<1&&(d++,t(h,v<A?S:C,A,c))),A=h.length):u===0&&(d++,h=[0]),w[m++]=d,u&&h[0]?h[A++]=x[I]||0:(h=[x[I]],A=1);while((I++<N||h[0]!==void 0)&&B--);f=h[0]!==void 0}w[0]||w.shift()}if(p==1)k.e=l,Xi=f;else{for(m=1,d=w[0];d>=10;d/=10)m++;k.e=m+l*p-1,E(k,a?o+k.e+1:o,s,f)}return k}}();function E(n,e,t,i){var r,o,s,a,c,u,l,m,d,p=n.constructor;e:if(e!=null){if(m=n.d,!m)return n;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=_,s=e,l=m[d=0],c=l/ce(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/_),a=m.length,d>=a)if(i){for(;a++<=d;)m.push(0);l=c=0,r=1,o%=_,s=o-_+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=_,s=o-_+r,c=s<0?0:l/ce(10,r-s-1)%10|0}if(i=i||e<0||m[d+1]!==void 0||(s<0?l:l%ce(10,r-s-1)),u=t<4?(c||i)&&(t==0||t==(n.s<0?3:2)):c>5||c==5&&(t==4||i||t==6&&(o>0?s>0?l/ce(10,r-s):0:m[d-1])%10&1||t==(n.s<0?8:7)),e<1||!m[0])return m.length=0,u?(e-=n.e+1,m[0]=ce(10,(_-e%_)%_),n.e=-e||0):m[0]=n.e=0,n;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=ce(10,_-o),m[d]=s>0?(l/ce(10,r-s)%ce(10,s)|0)*a:0),u)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(n.e++,m[0]==Ne&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=Ne)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return U&&(n.e>p.maxE?(n.d=null,n.e=NaN):n.e<p.minE&&(n.e=0,n.d=[0])),n}function Fe(n,e,t){if(!n.isFinite())return $i(n);var i,r=n.e,o=me(n.d),s=o.length;return e?(t&&(i=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+ze(i):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(n.e<0?"e":"e+")+n.e):r<0?(o="0."+ze(-r-1)+o,t&&(i=t-s)>0&&(o+=ze(i))):r>=s?(o+=ze(r+1-s),t&&(i=t-r-1)>0&&(o=o+"."+ze(i))):((i=r+1)<s&&(o=o.slice(0,i)+"."+o.slice(i)),t&&(i=t-s)>0&&(r+1===s&&(o+="."),o+=ze(i))),o}function $t(n,e){var t=n[0];for(e*=_;t>=10;t/=10)e++;return e}function Qt(n,e,t){if(e>co)throw U=!0,t&&(n.precision=t),Error(zi);return E(new n(Zt),e,1,!0)}function Ke(n,e,t){if(e>Cn)throw Error(zi);return E(new n(jt),e,t,!0)}function ji(n){var e=n.length-1,t=e*_+1;if(e=n[e],e){for(;e%10==0;e/=10)t--;for(e=n[0];e>=10;e/=10)t++}return t}function ze(n){for(var e="";n--;)e+="0";return e}function Qi(n,e,t,i){var r,o=new n(1),s=Math.ceil(i/_+4);for(U=!1;;){if(t%2&&(o=o.times(e),Gi(o.d,s)&&(r=!0)),t=fe(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Gi(e.d,s)}return U=!0,o}function qi(n){return n.d[n.d.length-1]&1}function Ji(n,e,t){for(var i,r=new n(e[0]),o=0;++o<e.length;)if(i=new n(e[o]),i.s)r[t](i)&&(r=i);else{r=i;break}return r}function Kn(n,e){var t,i,r,o,s,a,c,u=0,l=0,m=0,d=n.constructor,p=d.rounding,f=d.precision;if(!n.d||!n.d[0]||n.e>17)return new d(n.d?n.d[0]?n.s<0?0:1/0:1:n.s?n.s<0?0:n:0/0);for(e==null?(U=!1,c=f):c=e,a=new d(.03125);n.e>-2;)n=n.times(a),m+=5;for(i=Math.log(ce(2,m))/Math.LN10*2+5|0,c+=i,t=o=s=new d(1),d.precision=c;;){if(o=E(o.times(n),c,1),t=t.times(++l),a=s.plus(ee(o,t,c,1)),me(a.d).slice(0,c)===me(s.d).slice(0,c)){for(r=m;r--;)s=E(s.times(s),c,1);if(e==null)if(u<3&&Ct(s.d,c-i,p,u))d.precision=c+=10,t=o=a=new d(1),l=0,u++;else return E(s,d.precision=f,p,U=!0);else return d.precision=f,s}s=a}}function He(n,e){var t,i,r,o,s,a,c,u,l,m,d,p=1,f=10,b=n,g=b.d,k=b.constructor,w=k.rounding,h=k.precision;if(b.s<0||!g||!g[0]||!b.e&&g[0]==1&&g.length==1)return new k(g&&!g[0]?-1/0:b.s!=1?NaN:g?0:b);if(e==null?(U=!1,l=h):l=e,k.precision=l+=f,t=me(g),i=t.charAt(0),Math.abs(o=b.e)<15e14){for(;i<7&&i!=1||i==1&&t.charAt(1)>3;)b=b.times(n),t=me(b.d),i=t.charAt(0),p++;o=b.e,i>1?(b=new k("0."+t),o++):b=new k(i+"."+t.slice(1))}else return u=Qt(k,l+2,h).times(o+""),b=He(new k(i+"."+t.slice(1)),l-f).plus(u),k.precision=h,e==null?E(b,h,w,U=!0):b;for(m=b,c=s=b=ee(b.minus(1),b.plus(1),l,1),d=E(b.times(b),l,1),r=3;;){if(s=E(s.times(d),l,1),u=c.plus(ee(s,new k(r),l,1)),me(u.d).slice(0,l)===me(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(Qt(k,l+2,h).times(o+""))),c=ee(c,new k(p),l,1),e==null)if(Ct(c.d,l-f,w,a))k.precision=l+=f,u=s=b=ee(m.minus(1),m.plus(1),l,1),d=E(b.times(b),l,1),r=a=1;else return E(c,k.precision=h,w,U=!0);else return k.precision=h,c;c=u,r+=2}}function $i(n){return String(n.s*n.s/0)}function Nn(n,e){var t,i,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(i=e.search(/e/i))>0?(t<0&&(t=i),t+=+e.slice(i+1),e=e.substring(0,i)):t<0&&(t=e.length),i=0;e.charCodeAt(i)===48;i++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(i,r),e){if(r-=i,n.e=t=t-i-1,n.d=[],i=(t+1)%_,t<0&&(i+=_),i<r){for(i&&n.d.push(+e.slice(0,i)),r-=_;i<r;)n.d.push(+e.slice(i,i+=_));e=e.slice(i),i=_-e.length}else i-=r;for(;i--;)e+="0";n.d.push(+e),U&&(n.e>n.constructor.maxE?(n.d=null,n.e=NaN):n.e<n.constructor.minE&&(n.e=0,n.d=[0]))}else n.e=0,n.d=[0];return n}function mo(n,e){var t,i,r,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Zi.test(e))return Nn(n,e)}else if(e==="Infinity"||e==="NaN")return+e||(n.s=NaN),n.e=NaN,n.d=null,n;if(so.test(e))t=16,e=e.toLowerCase();else if(oo.test(e))t=2;else if(ao.test(e))t=8;else throw Error(Ye+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,i=n.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=Qi(i,new i(t),o,o*2)),u=Yt(e,t,Ne),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new i(n.s*0):(n.e=$t(u,l),n.d=u,U=!1,s&&(n=ee(n,r,a*4)),c&&(n=n.times(Math.abs(c)<54?ce(2,c):Kt.pow(2,c))),U=!0,n)}function po(n,e){var t,i=e.d.length;if(i<3)return e.isZero()?e:pt(n,2,e,e);t=1.4*Math.sqrt(i),t=t>16?16:t|0,e=e.times(1/en(5,t)),e=pt(n,2,e,e);for(var r,o=new n(5),s=new n(16),a=new n(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function pt(n,e,t,i,r){var o,s,a,c,u=1,l=n.precision,m=Math.ceil(l/_);for(U=!1,c=t.times(t),a=new n(i);;){if(s=ee(a.times(c),new n(e++*e++),l,1),a=r?i.plus(s):i.minus(s),i=ee(s.times(c),new n(e++*e++),l,1),s=a.plus(i),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=i,i=s,s=o,u++}return U=!0,s.d.length=m+1,s}function en(n,e){for(var t=n;--e;)t*=n;return t}function er(n,e){var t,i=e.s<0,r=Ke(n,n.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return De=i?4:1,e;if(t=e.divToInt(r),t.isZero())De=i?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return De=qi(t)?i?2:3:i?4:1,e;De=qi(t)?i?1:4:i?3:2}return e.minus(r).abs()}function Rn(n,e,t,i){var r,o,s,a,c,u,l,m,d,p=n.constructor,f=t!==void 0;if(f?(Pe(t,1,Ze),i===void 0?i=p.rounding:Pe(i,0,8)):(t=p.precision,i=p.rounding),!n.isFinite())l=$i(n);else{for(l=Fe(n),s=l.indexOf("."),f?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=Yt(Fe(d),10,r),d.e=d.d.length),m=Yt(l,10,r),o=c=m.length;m[--c]==0;)m.pop();if(!m[0])l=f?"0p+0":"0";else{if(s<0?o--:(n=new p(n),n.d=m,n.e=o,n=ee(n,d,t,i,0,r),m=n.d,o=n.e,u=Xi),s=m[t],a=r/2,u=u||m[t+1]!==void 0,u=i<4?(s!==void 0||u)&&(i===0||i===(n.s<0?3:2)):s>a||s===a&&(i===4||u||i===6&&m[t-1]&1||i===(n.s<0?8:7)),m.length=t,u)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(c=m.length;!m[c-1];--c);for(s=0,l="";s<c;s++)l+=In.charAt(m[s]);if(f){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(m=Yt(l,r,e),c=m.length;!m[c-1];--c);for(s=1,l="1.";s<c;s++)l+=In.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return n.s<0?"-"+l:l}function Gi(n,e){if(n.length>e)return n.length=e,!0}function fo(n){return new this(n).abs()}function bo(n){return new this(n).acos()}function yo(n){return new this(n).acosh()}function go(n,e){return new this(n).plus(e)}function Po(n){return new this(n).asin()}function wo(n){return new this(n).asinh()}function Ao(n){return new this(n).atan()}function To(n){return new this(n).atanh()}function ko(n,e){n=new this(n),e=new this(e);var t,i=this.precision,r=this.rounding,o=i+4;return!n.s||!e.s?t=new this(NaN):!n.d&&!e.d?(t=Ke(this,o,1).times(e.s>0?.25:.75),t.s=n.s):!e.d||n.isZero()?(t=e.s<0?Ke(this,i,r):new this(0),t.s=n.s):!n.d||e.isZero()?(t=Ke(this,o,1).times(.5),t.s=n.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ee(n,e,o,1)),e=Ke(this,o,1),this.precision=i,this.rounding=r,t=n.s<0?t.minus(e):t.plus(e)):t=this.atan(ee(n,e,o,1)),t}function ho(n){return new this(n).cbrt()}function Bo(n){return E(n=new this(n),n.e+1,2)}function xo(n,e,t){return new this(n).clamp(e,t)}function Io(n){if(!n||typeof n!="object")throw Error(Jt+"Object expected");var e,t,i,r=n.defaults===!0,o=["precision",1,Ze,"rounding",0,8,"toExpNeg",-dt,0,"toExpPos",0,dt,"maxE",0,dt,"minE",-dt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=Sn[t]),(i=n[t])!==void 0)if(fe(i)===i&&i>=o[e+1]&&i<=o[e+2])this[t]=i;else throw Error(Ye+t+": "+i);if(t="crypto",r&&(this[t]=Sn[t]),(i=n[t])!==void 0)if(i===!0||i===!1||i===0||i===1)if(i)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Hi);else this[t]=!1;else throw Error(Ye+t+": "+i);return this}function So(n){return new this(n).cos()}function Co(n){return new this(n).cosh()}function tr(n){var e,t,i;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,Ui(o)){u.s=o.s,U?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;U?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return Nn(u,o.toString())}else if(c!=="string")throw Error(Ye+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),Zi.test(o)?Nn(u,o):mo(u,o)}if(r.prototype=T,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Io,r.clone=tr,r.isDecimal=Ui,r.abs=fo,r.acos=bo,r.acosh=yo,r.add=go,r.asin=Po,r.asinh=wo,r.atan=Ao,r.atanh=To,r.atan2=ko,r.cbrt=ho,r.ceil=Bo,r.clamp=xo,r.cos=So,r.cosh=Co,r.div=Ko,r.exp=No,r.floor=Ro,r.hypot=Lo,r.ln=Fo,r.log=Mo,r.log10=Eo,r.log2=vo,r.max=Oo,r.min=Vo,r.mod=Wo,r.mul=Do,r.pow=_o,r.random=qo,r.round=Go,r.sign=Uo,r.sin=Xo,r.sinh=zo,r.sqrt=Ho,r.sub=Yo,r.sum=Zo,r.tan=jo,r.tanh=Qo,r.trunc=Jo,n===void 0&&(n={}),n&&n.defaults!==!0)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<i.length;)n.hasOwnProperty(t=i[e++])||(n[t]=this[t]);return r.config(n),r}function Ko(n,e){return new this(n).div(e)}function No(n){return new this(n).exp()}function Ro(n){return E(n=new this(n),n.e+1,3)}function Lo(){var n,e,t=new this(0);for(U=!1,n=0;n<arguments.length;)if(e=new this(arguments[n++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return U=!0,new this(1/0);t=e}return U=!0,t.sqrt()}function Ui(n){return n instanceof Kt||n&&n.toStringTag===Yi||!1}function Fo(n){return new this(n).ln()}function Mo(n,e){return new this(n).log(e)}function vo(n){return new this(n).log(2)}function Eo(n){return new this(n).log(10)}function Oo(){return Ji(this,arguments,"lt")}function Vo(){return Ji(this,arguments,"gt")}function Wo(n,e){return new this(n).mod(e)}function Do(n,e){return new this(n).mul(e)}function _o(n,e){return new this(n).pow(e)}function qo(n){var e,t,i,r,o=0,s=new this(1),a=[];if(n===void 0?n=this.precision:Pe(n,1,Ze),i=Math.ceil(n/_),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(i));o<i;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(i*=4);o<i;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=i/4}else throw Error(Hi);else for(;o<i;)a[o++]=Math.random()*1e7|0;for(i=a[--o],n%=_,i&&n&&(r=ce(10,_-n),a[o]=(i/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=_)a.shift();for(i=1,r=a[0];r>=10;r/=10)i++;i<_&&(t-=_-i)}return s.e=t,s.d=a,s}function Go(n){return E(n=new this(n),n.e+1,this.rounding)}function Uo(n){return n=new this(n),n.d?n.d[0]?n.s:0*n.s:n.s||NaN}function Xo(n){return new this(n).sin()}function zo(n){return new this(n).sinh()}function Ho(n){return new this(n).sqrt()}function Yo(n,e){return new this(n).sub(e)}function Zo(){var n=0,e=arguments,t=new this(e[n]);for(U=!1;t.s&&++n<e.length;)t=t.plus(e[n]);return U=!0,E(t,this.precision,this.rounding)}function jo(n){return new this(n).tan()}function Qo(n){return new this(n).tanh()}function Jo(n){return E(n=new this(n),n.e+1,1)}T[Symbol.for("nodejs.util.inspect.custom")]=T.toString;T[Symbol.toStringTag]="Decimal";var Kt=T.constructor=tr(Sn);Zt=new Kt(Zt);jt=new Kt(jt);var G=Kt;import ss from"big.js";import Ea from"bn.js";import $o from"toformat";var es=$o,Nt=es;import nn from"big.js";import ns from"bn.js";import is from"decimal.js-light";import Rt from"bn.js";var nr=9007199254740991;function Me(n){let e=pe("Raydium_parseBigNumberish");if(n instanceof Rt)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new Rt(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=nr||n<=-nr)&&e.logWithError(`BigNumberish number overflow: ${n}`),new Rt(String(n))):typeof n=="bigint"?new Rt(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new Rt(0))}var tn=pe("module/fraction"),Ln=Nt(nn),Lt=Nt(is),rs={[0]:Lt.ROUND_DOWN,[1]:Lt.ROUND_HALF_UP,[2]:Lt.ROUND_UP},os={[0]:nn.roundDown,[1]:nn.roundHalfUp,[2]:nn.roundUp},ie=class{constructor(e,t=new ns(1)){this.numerator=Me(e),this.denominator=Me(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new ie(this.denominator,this.numerator)}add(e){let t=e instanceof ie?e:new ie(Me(e));return this.denominator.eq(t.denominator)?new ie(this.numerator.add(t.numerator),this.denominator):new ie(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof ie?e:new ie(Me(e));return this.denominator.eq(t.denominator)?new ie(this.numerator.sub(t.numerator),this.denominator):new ie(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof ie?e:new ie(Me(e));return new ie(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof ie?e:new ie(Me(e));return new ie(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},i=1){Number.isInteger(e)||tn.logWithError(`${e} is not an integer.`),e<=0&&tn.logWithError(`${e} is not positive.`),Lt.set({precision:e+1,rounding:rs[i]});let r=new Lt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},i=1){return Number.isInteger(e)||tn.logWithError(`${e} is not an integer.`),e<0&&tn.logWithError(`${e} is negative.`),Ln.DP=e,Ln.RM=os[i]||1,new Ln(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Xa=pe("Raydium_amount"),za=Nt(ss);import{PublicKey as us}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ir}from"@solana/spl-token";var Fn={chainId:101,address:us.default.toBase58(),programId:ir.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},je={chainId:101,address:"So11111111111111111111111111111111111111112",programId:ir.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as En}from"@solana/web3.js";import{PublicKey as oe,SystemProgram as rr,SYSVAR_RENT_PUBKEY as cs}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ls}from"@solana/spl-token";function Mn({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var eu=[Mn({pubkey:ls,isWritable:!1}),Mn({pubkey:rr.programId,isWritable:!1}),Mn({pubkey:cs,isWritable:!1})];function or({publicKey:n,transformSol:e}){let t=sr(n.toString());if(t instanceof oe)return e&&t.equals(Ft)?rn:t;if(e&&t.toString()===Ft.toBase58())return rn;if(typeof t=="string"){if(t===oe.default.toBase58())return oe.default;try{return new oe(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function sr(n){try{return new oe(n)}catch{return n}}var ms=new oe("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ds=new oe("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),vn=new oe("SysvarRent111111111111111111111111111111111"),tu=new oe("SysvarC1ock11111111111111111111111111111111"),ft=new oe("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),nu=new oe("Sysvar1nstructions1111111111111111111111111"),iu=rr.programId,ru=new oe("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ou=new oe("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),su=new oe("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),au=new oe("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),uu=new oe("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),cu=new oe("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),lu=new oe("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),mu=new oe("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),du=new oe("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),pu=new oe("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),fu=new oe("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),rn=new oe("So11111111111111111111111111111111111111112"),Ft=oe.default;var On=class{constructor({mint:e,decimals:t,symbol:i,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===Ft.toBase58()||e instanceof En&&Ft.equals(e)){this.decimals=je.decimals,this.symbol=je.symbol,this.name=je.name,this.mint=new En(je.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=i||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?En.default:or({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Qe=On;Qe.WSOL=new On(Q(z({},je),{mint:je.address}));var Vn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:i="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=i}equals(e){return this===e}},on=Vn;on.SOL=new Vn(Fn);import ps from"bn.js";var Iu=new ie(new ps(100));var Lu=pe("Raydium_price");var fs=new ve(0),sc=new ve(1),ac=new ve(2),uc=new ve(3),cc=new ve(5),as=new ve(10),lc=new ve(100),mc=new ve(1e3),dc=new ve(1e4);function ar(n,e,t){return n.mul(e).add(t).sub(new ve(1)).div(t)}function _n(n,e=1,t=[]){let i=[...n];if(e<=0)return t;for(;i.length;)t.push(i.splice(0,e));return t}import{PublicKey as Ts}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ks}from"@solana/spl-token";import{ComputeBudgetProgram as ur,Keypair as lr,PublicKey as bs,Transaction as mr,TransactionMessage as ys,VersionedTransaction as dr}from"@solana/web3.js";var it={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as gs}from"@solana/spl-token";var cr=pe("Raydium_txUtil"),pr=1644;function an(n){let e=[],t=[];return n.microLamports&&(e.push(ur.setComputeUnitPrice({microLamports:n.microLamports})),t.push(it.SetComputeUnitPrice)),n.units&&(e.push(ur.setComputeUnitLimit({units:n.units})),t.push(it.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function bt(n,e){var i,r;let t=e!=null?e:"confirmed";return(r=await((i=n.getLatestBlockhash)==null?void 0:i.call(n,{commitment:t})))==null?void 0:r.blockhash}async function un(n,e){return n.getSignatureStatuses([e]),new Promise((t,i)=>{let r=setTimeout(i,6e4);n.onSignature(e,o=>{if(clearTimeout(r),!o.err){t("");return}i(Object.assign(o.err,{txId:e}))},"confirmed")})}function Ps(n,e){n.length<1&&cr.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&cr.logWithError(`no signers provided:, ${e.toString()}`);let t=new mr;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<pr}catch{return!1}}function ge(n,e){let[t,i]=bs.findProgramAddressSync(n,e);return{publicKey:t,nonce:i}}function Mt({instructions:n,payer:e,signers:t}){return Ps(n,[e,...t])}function vt({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:i=lr.generate().publicKey.toString()}){let o=new ys({payerKey:e,recentBlockhash:i,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new dr(o).serialize()).toString("base64").length<pr}catch{return!1}}var ws=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),As=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof dr&&(e=ws(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function rt(n){let e=[];return n.forEach(t=>{t instanceof mr&&(t.recentBlockhash||(t.recentBlockhash=gs.toBase58()),t.feePayer||(t.feePayer=lr.generate().publicKey)),e.push(As(t))}),console.log("simulate tx string:",e),e}function Re(n,e,t){return ge([n.toBuffer(),(t!=null?t:ks).toBuffer(),e.toBuffer()],new Ts("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as V}from"@solana/web3.js";var Fc=new V("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Mc=new V("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),vc=new V("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Ec=new V("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Oc=new V("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Vc=new V("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Wc=new V("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Dc=new V("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),_c=new V("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),qc=new V("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),hs=new V("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Bs=new V("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),xs=new V("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Gc=new V("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Uc=new V("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Xc=new V("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),zc=new V("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Hc=new V("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Yc=new V("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Zc=new V("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),jc=new V("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Qc=new V("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Jc=new V("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),$c=new V("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),el=new V("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),le=new V("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),tl=new V("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),nl=new V("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),il=new V("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),rl=new V("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),ol=new V("6s1xP3hpbAfFoNtUNF8mfHsjr2Bd97JxFJRWLbL6aHuX");var sl={OPEN_BOOK_PROGRAM:new V("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),SERUM_PROGRAM_ID_V3:new V("Ray1111111111111111111111111111111111111111"),AMM_V4:new V("DRaya7Kj3aMWQSy19kSjvmuwq9docCHofyP9kanQGaav"),AMM_STABLE:new V("DRayDdXc1NZQ9C3hRWmoSf8zK4iapgMnjdNZWrfwsP8m"),CLMM_PROGRAM_ID:new V("DRayAUgENGQBKVaX8owNhgzkEDyoHTGVEGHVJT1E9pfH"),CLMM_LOCK_PROGRAM_ID:new V("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),CLMM_LOCK_AUTH_ID:new V("6Aoh8h2Lw2m5UGxYR8AdAL87jTWYeKoxM52mJRzfYwN"),CREATE_CPMM_POOL_PROGRAM:new V("DRaycpLY18LhpbydsBWbVJtxpNv9oXPgjRSfpF2bWpYb"),CREATE_CPMM_POOL_AUTH:new V("CXniRufdq5xL8t8jZAPxsPZDpuudwuJSPWnbcD5Y5Nxq"),CREATE_CPMM_POOL_FEE_ACC:new V("3oE58BKVt8KuYkGxx8zBojugnymWmBiyafWgMrnb6eYy"),LOCK_CPMM_PROGRAM:new V("DRay25Usp3YJAi7beckgpGUC7mGJ2cR1AVPxhYfwVCUX"),LOCK_CPMM_AUTH:new V("7qWVV8UY2bRJfDLP4s37YzBPKUkVB46DStYJBpYbQzu3"),UTIL1216:V.default,Router:new V("DRaybByLpbUL57LJARs3j8BitTxVfzBg351EaMr5UTCd"),FARM_PROGRAM_ID_V3:new V("DRayWyrLmEW5KEeqs8kdTMMaBabapqagaBC7KWpGtJeZ"),FARM_PROGRAM_ID_V4:new V("Ray1111111111111111111111111111111111111111"),FARM_PROGRAM_ID_V5:new V("DRayiCGSZgku1GTK6rXD6mVDdingXy6APAH1R6R5L2LC"),FARM_PROGRAM_ID_V6:new V("DRayzbYakXs45ELHkzH6vC3fuhQqTAnv5A68gdFuvZyZ"),LAUNCHPAD_PROGRAM:new V("DRay6fNdQ5J82H7xV6uq2aV3mNrUZ1J4PgSKsWgptcm6"),LAUNCHPAD_AUTH:new V("5xqNaZXX5eUi4p5HU4oz9i5QnwRNT2y6oN7yyn4qENeq"),LAUNCHPAD_PLATFORM:new V("2Jx4KTDrVSdWNazuGpcA8n3ZLTRGGBDxAWhuKe2Xcj2a"),LAUNCHPAD_CONFIG:new V("7ZR4zD7PYfY2XxoG1Gxcy2EgEeGYrpxrwzPuwdUBssEt"),FEE_DESTINATION_ID:new V("9y8ENuuZ3b19quffx9hQvRVygG5ky6snHfRvGpuSfeJy"),MODEL_DATA_PUBKEY:new V("Ray1111111111111111111111111111111111111111")};import be from"bn.js";var Et=1e4;function qn(n,e){let{div:t,mod:i}=n.divmod(e);return i.gt(new be(0))?t.add(new be(1)):t}function ot(n,e){if(n.isZero())return new be(0);let t=n.div(e);return t.isZero()?new be(1):n.mod(e).gt(new be(0))?t.add(new be(1)):t}function Gn(n,e,t){if(e===void 0)return{amount:n,fee:void 0,expirationTime:void 0};let i=Math.floor(t/432e3),r=i<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new be(r.maximumFee.toString()),s=i<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0,a=qn(n.mul(new be(r.transferFeeBasisPoints)),new be(Et)),c=a.gt(o)?o:a;return{amount:n,fee:c,expirationTime:s}}function Un(n,e,t){if(e===void 0)return{amount:n,fee:void 0,expirationTime:void 0};let i=Math.floor(t/432e3),r=i<e.newerTransferFee.epoch?e.olderTransferFee:e.newerTransferFee,o=new be(r.maximumFee.toString()),s=i<e.newerTransferFee.epoch?(Number(e.newerTransferFee.epoch)*432e3-t)*400/1e3:void 0;if(r.transferFeeBasisPoints===Et){let a=new be(r.maximumFee.toString());return{amount:n.add(a),fee:a,expirationTime:s}}else{let a=qn(n.mul(new be(Et)),new be(Et-r.transferFeeBasisPoints)),c=new be(r.maximumFee.toString()),u=a.sub(n).gt(c)?n.add(c):a,l=qn(u.mul(new be(r.transferFeeBasisPoints)),new be(Et)),m=l.gt(o)?o:l;return{amount:u,fee:m,expirationTime:s}}}import{PublicKey as ml}from"@solana/web3.js";import pl from"bn.js";import Is from"bn.js";var st=new Is(1e6);import{MINT_SIZE as Xl,TOKEN_PROGRAM_ID as zl,getTransferFeeConfig as Hl,unpackMint as Yl}from"@solana/spl-token";var Xn=pe("Raydium_accountInfo_util");async function Ot(n,e,t){let{batchRequest:i,commitment:r="confirmed",chunkCount:o=100}=z({batchRequest:!1},t),s=_n(e,o),a=new Array(s.length).fill([]);if(i){let c=s.map(m=>{let d=n._buildArgs([m.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),u=_n(c,10);a=(await(await Promise.all(u.map(async m=>await n._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&Xn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:f,lamports:b,owner:g,rentEpoch:k}=d;return p.length!==2&&p[1]!=="base64"&&Xn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:f,lamports:b,owner:new Ss(g),rentEpoch:k}}return null})))}else try{a=await Promise.all(s.map(c=>n.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&Xn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function _e(n,e,t){let i=await Ot(n,e.map(r=>r.pubkey),t);return e.map((r,o)=>Q(z({},r),{accountInfo:i[o]}))}async function Hn({connection:n,address:e,cluster:t="mainnet"}){let i=await Ot(n,[...new Set(e.map(o=>o.toString()))].map(o=>new zn(o))),r={};for(let o=0;o<e.length;o++){let s=i[o],a=e[o];if(!s)continue;let c=new Pt({key:a,state:Pt.deserialize(s.data)});r[a.toString()]=c,t==="devnet"?gt[a.toString()]=c:yt[a.toString()]=c}return r}var yt={},Yn=async n=>{let e="AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU";if(yt[e])return yt;let t=new zn(e),i=await n.getAccountInfo(t);return i&&(yt[e]=new Pt({key:t,state:Pt.deserialize(i.data)})),yt},gt={},Zn=async n=>{let e="EFhMuDw1PKEuckuFRW9PavNfTH4LKP5uKHgyXDmWpFCq";if(gt[e])return gt;let t=new zn(e),i=await n.getAccountInfo(t);return i&&(gt[e]=new Pt({key:t,state:Pt.deserialize(i.data)})),gt};var cn=2e3,ln=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.loopMultiTxStatus=!!e.loopMultiTxStatus}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var i;let e=(await Ks.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(i=e==null?void 0:e[15])!=null?i:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:i}=an(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...i),!0}return!1}addTipInstruction(e){var t;return e?(this.endInstructions.push(Cs.transfer({fromPubkey:(t=e.feePayer)!=null?t:this.feePayer,toPubkey:new wt(e.address),lamports:BigInt(e.amount.toString())})),this.endInstructionTypes.push(it.TransferTip),!0):!1}async calComputeBudget({config:e,defaultIns:t}){try{let i=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(i))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:i=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...i),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==wt.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(z({},t||{})):this.build(t)}build(e){var i;let t=new Vt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((i=this.owner)==null?void 0:i.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var l;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a,notSendToRpc:c}=r||{},u=o!=null?o:await bt(this.connection,this.blockhashCommitment);if(t.recentBlockhash=u,this.signers.length&&t.sign(...this.signers),rt([t]),(l=this.owner)!=null&&l.isKeyPair)return{txId:a?await jn(this.connection,t,this.signers.find(d=>d.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let m=await this.signAllTransactions([t]);if(this.signers.length)for(let d of m)try{d.sign(...this.signers)}catch{}return{txId:c?"":await this.connection.sendRawTransaction(m[0].serialize(),{skipPreflight:s}),signedTx:m[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:i}=e,{transaction:r}=this.build(i),o=t.filter(l=>l.transaction.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var k;let{sequentially:m,onTxUpdate:d,skipTxCount:p=0,recentBlockHash:f,skipPreflight:b=!0}=l||{},g=f!=null?f:await bt(this.connection,this.blockhashCommitment);if((k=this.owner)!=null&&k.isKeyPair){if(m){let w=[],h=0;for(let A of s){if(++h,h<=p)continue;let P=await jn(this.connection,A,this.signers.find(B=>B.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:b});w.push(P)}return{txIds:w,signedTxs:s}}return{txIds:await await Promise.all(s.map(async w=>(w.recentBlockhash=g,await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:b})))),signedTxs:s}}if(this.signAllTransactions){let w=s.map((A,P)=>(A.recentBlockhash=g,a[P].length&&A.sign(...a[P]),A));rt(w);let h=await this.signAllTransactions(w);if(m){let A=0,P=[],B=async()=>{if(!h[A])return;let K=await this.connection.sendRawTransaction(h[A].serialize(),{skipPreflight:b});P.push({txId:K,status:"sent",signedTx:h[A]}),d==null||d([...P]),A++;let I=!1,N=null,R=null,v=S=>{N!==null&&clearInterval(N),R!==null&&this.connection.removeSignatureListener(R);let q=P.findIndex(H=>H.txId===K);if(q>-1){if(P[q].status==="error"||P[q].status==="success")return;P[q].status=S.err?"error":"success"}d==null||d([...P]),S.err||B()};this.loopMultiTxStatus&&(N=setInterval(async()=>{var S;if(I){clearInterval(N);return}try{let q=await this.connection.getTransaction(K,{commitment:"confirmed",maxSupportedTransactionVersion:0});q&&(I=!0,clearInterval(N),v({err:((S=q.meta)==null?void 0:S.err)||null}),console.log("tx status from getTransaction:",K))}catch(q){I=!0,clearInterval(N),console.error("getTransaction timeout:",q,K)}},cn)),R=this.connection.onSignature(K,S=>{if(I){this.connection.removeSignatureListener(R);return}I=!0,v(S)},"confirmed"),this.connection.getSignatureStatus(K)};return await B(),{txIds:P.map(K=>K.txId),signedTxs:h}}else{let A=[];for(let P=0;P<h.length;P+=1){let B=await this.connection.sendRawTransaction(h[P].serialize(),{skipPreflight:b});A.push(B)}return{txIds:A,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:i}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:i||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:i})}async buildV0(e){var b;let f=e||{},{lookupTableCache:t={},lookupTableAddress:i=[],forerunCreate:r,recentBlockhash:o}=f,s=nt(f,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=z(z({},this.cluster==="devnet"?await Zn(this.connection):await Yn(this.connection)),t),c=Array.from(new Set([...i,...this.lookupTableAddress])),u=[];for(let g of c)a[g]===void 0&&u.push(new wt(g));let l=await Hn({connection:this.connection,address:u});for(let[g,k]of Object.entries(l))a[g]=k;let m=r?wt.default.toBase58():o!=null?o:await bt(this.connection,this.blockhashCommitment),d=new Wt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((b=this.owner)==null?void 0:b.signer)&&!this.signers.some(g=>g.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new Dt(d);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async g=>{var A;let{skipPreflight:k=!0,sendAndConfirm:w,notSendToRpc:h}=g||{};if(rt([p]),(A=this.owner)!=null&&A.isKeyPair){let P=await this.connection.sendTransaction(p,{skipPreflight:k});return w&&await un(this.connection,P),{txId:P,signedTx:p}}if(this.signAllTransactions){let P=await this.signAllTransactions([p]);if(this.signers.length)for(let B of P)try{B.sign(this.signers)}catch{}return{txId:h?"":await this.connection.sendTransaction(P[0],{skipPreflight:k}),signedTx:P[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:i}=e,{transaction:r}=await this.buildV0(i),o=t.filter(l=>l.builder.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,m)=>{l.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:i,execute:async l=>{var b;let{sequentially:m,onTxUpdate:d,recentBlockHash:p,skipPreflight:f=!0}=l||{};if(p&&s.forEach(g=>g.message.recentBlockhash=p),rt(s),(b=this.owner)!=null&&b.isKeyPair){if(m){let g=[];for(let k of s){let w=await this.connection.sendTransaction(k,{skipPreflight:f});await un(this.connection,w),g.push(w)}return{txIds:g,signedTxs:s}}return{txIds:await Promise.all(s.map(async g=>await this.connection.sendTransaction(g,{skipPreflight:f}))),signedTxs:s}}if(this.signAllTransactions){let g=await this.signAllTransactions(s);if(m){let k=0,w=[],h=async()=>{if(!g[k])return;let A=await this.connection.sendTransaction(g[k],{skipPreflight:f});w.push({txId:A,status:"sent",signedTx:g[k]}),d==null||d([...w]),k++;let P=!1,B=null,K=null,I=N=>{B!==null&&clearInterval(B),K!==null&&this.connection.removeSignatureListener(K);let R=w.findIndex(v=>v.txId===A);if(R>-1){if(w[R].status==="error"||w[R].status==="success")return;w[R].status=N.err?"error":"success"}d==null||d([...w]),N.err||h()};this.loopMultiTxStatus&&(B=setInterval(async()=>{var N;if(P){clearInterval(B);return}try{let R=await this.connection.getTransaction(A,{commitment:"confirmed",maxSupportedTransactionVersion:0});R&&(P=!0,clearInterval(B),I({err:((N=R.meta)==null?void 0:N.err)||null}),console.log("tx status from getTransaction:",A))}catch(R){P=!0,clearInterval(B),console.error("getTransaction timeout:",R,A)}},cn)),K=this.connection.onSignature(A,N=>{if(P){this.connection.removeSignatureListener(K);return}P=!0,I(N)},"confirmed"),this.connection.getSignatureStatus(A)};return h(),{txIds:[],signedTxs:g}}else{let k=[];for(let w=0;w<g.length;w+=1){let h=await this.connection.sendTransaction(g[w],{skipPreflight:f});k.push(h)}return{txIds:k,signedTxs:g}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuild(e){var d;let m=e||{},{splitIns:t=[],computeBudgetConfig:i}=m,r=nt(m,["splitIns","computeBudgetConfig"]),o=i?an(i):{instructions:[],instructionTypes:[]},s=this.signers.reduce((p,f)=>Q(z({},p),{[f.publicKey.toBase58()]:f}),{}),a=[],c=[],u=[],l=0;if(this.allInstructions.forEach(p=>{let f=[...u,p],b=i?[...o.instructions,...f]:f,k=[...new Set(f.map(w=>w.keys.filter(h=>h.isSigner).map(h=>h.pubkey.toString())).flat()).values()].map(w=>new wt(w));if(p!==t[l]&&u.length<12&&(Mt({instructions:b,payer:this.feePayer,signers:k})||Mt({instructions:f,payer:this.feePayer,signers:k})))u.push(p);else{if(u.length===0)throw Error("item ins too big");l+=p===t[l]?1:0,Mt({instructions:i?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:k})?a.push(new Vt().add(...o.instructions,...u)):a.push(new Vt().add(...u)),c.push(Array.from(new Set(u.map(w=>w.keys.filter(h=>h.isSigner).map(h=>h.pubkey.toString())).flat())).map(w=>s[w]).filter(w=>w!==void 0)),u=[p]}}),u.length>0){let f=[...new Set(u.map(b=>b.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(b=>s[b]).filter(b=>b!==void 0);Mt({instructions:i?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:f.map(b=>b.publicKey)})?a.push(new Vt().add(...o.instructions,...u)):a.push(new Vt().add(...u)),c.push(f)}return a.forEach(p=>p.feePayer=this.feePayer),(d=this.owner)!=null&&d.signer&&c.forEach(p=>{p.some(f=>f.publicKey.equals(this.owner.publicKey))||p.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async p=>{var A;let{sequentially:f,onTxUpdate:b,skipTxCount:g=0,recentBlockHash:k,skipPreflight:w=!0}=p||{},h=k!=null?k:await bt(this.connection,this.blockhashCommitment);if(a.forEach(async(P,B)=>{P.recentBlockhash=h,c[B].length&&P.sign(...c[B])}),rt(a),(A=this.owner)!=null&&A.isKeyPair){if(f){let P=0,B=[];for(let K of a){if(++P,P<=g){B.push("tx skipped");continue}let I=await jn(this.connection,K,this.signers.find(N=>N.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:w});B.push(I)}return{txIds:B,signedTxs:a}}return{txIds:await Promise.all(a.map(async P=>await this.connection.sendRawTransaction(P.serialize(),{skipPreflight:w}))),signedTxs:a}}if(this.signAllTransactions){let P=await this.signAllTransactions(a.slice(g,a.length)),B=[...a.slice(0,g),...P];if(f){let K=0,I=[],N=async()=>{if(!B[K])return;K<g&&(I.push({txId:"",status:"success",signedTx:B[K]}),b==null||b([...I]),K++,N());let R=await this.connection.sendRawTransaction(B[K].serialize(),{skipPreflight:w});I.push({txId:R,status:"sent",signedTx:B[K]}),b==null||b([...I]),K++;let v=!1,S=null,q=null,H=x=>{S!==null&&clearInterval(S),q!==null&&this.connection.removeSignatureListener(q);let C=I.findIndex(J=>J.txId===R);if(C>-1){if(I[C].status==="error"||I[C].status==="success")return;I[C].status=x.err?"error":"success"}b==null||b([...I]),x.err||N()};this.loopMultiTxStatus&&(S=setInterval(async()=>{var x;if(v){clearInterval(S);return}try{let C=await this.connection.getTransaction(R,{commitment:"confirmed",maxSupportedTransactionVersion:0});C&&(v=!0,clearInterval(S),H({err:((x=C.meta)==null?void 0:x.err)||null}),console.log("tx status from getTransaction:",R))}catch(C){v=!0,clearInterval(S),console.error("getTransaction timeout:",C,R)}},cn)),q=this.connection.onSignature(R,x=>{if(v){this.connection.removeSignatureListener(q);return}v=!0,H(x)},"confirmed"),this.connection.getSignatureStatus(R)};return await N(),{txIds:I.map(R=>R.txId),signedTxs:B}}else{let K=[];for(let I=0;I<B.length;I+=1){let N=await this.connection.sendRawTransaction(B[I].serialize(),{skipPreflight:w});K.push(N)}return{txIds:K,signedTxs:B}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(e){var h;let w=e||{},{computeBudgetConfig:t,splitIns:i=[],lookupTableCache:r={},lookupTableAddress:o=[]}=w,s=nt(w,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=z(z({},this.cluster==="devnet"?await Zn(this.connection):await Yn(this.connection)),r),c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let A of c)a[A]===void 0&&u.push(new wt(A));let l=await Hn({connection:this.connection,address:u});for(let[A,P]of Object.entries(l))a[A]=P;let m=t?an(t):{instructions:[],instructionTypes:[]},d=await bt(this.connection,this.blockhashCommitment),p=this.signers.reduce((A,P)=>Q(z({},A),{[P.publicKey.toBase58()]:P}),{}),f=[],b=[],g=[],k=0;if(this.allInstructions.forEach(A=>{let P=[...g,A],B=t?[...m.instructions,...P]:P;if(A!==i[k]&&g.length<12&&(vt({instructions:B,payer:this.feePayer,lookupTableAddressAccount:a})||vt({instructions:P,payer:this.feePayer,lookupTableAddressAccount:a})))g.push(A);else{if(g.length===0)throw Error("item ins too big");k+=A===i[k]?1:0;let K={};for(let I of[...new Set(c)])a[I]!==void 0&&(K[I]=a[I]);if(t&&vt({instructions:[...m.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let I=new Wt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m.instructions,...g]}).compileToV0Message(Object.values(a));f.push(new Dt(I))}else{let I=new Wt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...g]}).compileToV0Message(Object.values(a));f.push(new Dt(I))}b.push(Array.from(new Set(g.map(I=>I.keys.filter(N=>N.isSigner).map(N=>N.pubkey.toString())).flat())).map(I=>p[I]).filter(I=>I!==void 0)),g=[A]}}),g.length>0){let P=[...new Set(g.map(B=>B.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat()).values()].map(B=>p[B]).filter(B=>B!==void 0);if(t&&vt({instructions:[...m.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let B=new Wt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...m.instructions,...g]}).compileToV0Message(Object.values(a));f.push(new Dt(B))}else{let B=new Wt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...g]}).compileToV0Message(Object.values(a));f.push(new Dt(B))}b.push(P)}return(h=this.owner)!=null&&h.signer&&b.forEach(A=>{A.some(P=>P.publicKey.equals(this.owner.publicKey))||A.push(this.owner.signer)}),f.forEach((A,P)=>{A.sign(b[P])}),{builder:this,transactions:f,buildProps:e,signers:b,instructionTypes:this.instructionTypes,execute:async A=>{var R;let{sequentially:P,onTxUpdate:B,skipTxCount:K=0,recentBlockHash:I,skipPreflight:N=!0}=A||{};if(f.map(async(v,S)=>{b[S].length&&v.sign(b[S]),I&&(v.message.recentBlockhash=I)}),rt(f),(R=this.owner)!=null&&R.isKeyPair){if(P){let v=0,S=[];for(let q of f){if(++v,v<=K){console.log("skip tx: ",v),S.push("tx skipped");continue}let H=await this.connection.sendTransaction(q,{skipPreflight:N});await un(this.connection,H),S.push(H)}return{txIds:S,signedTxs:f}}return{txIds:await Promise.all(f.map(async v=>await this.connection.sendTransaction(v,{skipPreflight:N}))),signedTxs:f}}if(this.signAllTransactions){let v=await this.signAllTransactions(f.slice(K,f.length)),S=[...f.slice(0,K),...v];if(P){let q=0,H=[],x=async()=>{if(!S[q])return;if(q<K){H.push({txId:"",status:"success",signedTx:S[q]}),B==null||B([...H]),q++,x();return}let C=await this.connection.sendTransaction(S[q],{skipPreflight:N});H.push({txId:C,status:"sent",signedTx:S[q]}),B==null||B([...H]),q++;let J=!1,$=null,re=null,j=ae=>{$!==null&&clearInterval($),re!==null&&this.connection.removeSignatureListener(re);let ue=H.findIndex(de=>de.txId===C);if(ue>-1){if(H[ue].status==="error"||H[ue].status==="success")return;H[ue].status=ae.err?"error":"success"}B==null||B([...H]),ae.err||x()};this.loopMultiTxStatus&&($=setInterval(async()=>{var ae;if(J){clearInterval($);return}try{let ue=await this.connection.getTransaction(C,{commitment:"confirmed",maxSupportedTransactionVersion:0});ue&&(J=!0,clearInterval($),j({err:((ae=ue.meta)==null?void 0:ae.err)||null}),console.log("tx status from getTransaction:",C))}catch(ue){J=!0,clearInterval($),console.error("getTransaction timeout:",ue,C)}},cn)),re=this.connection.onSignature(C,ae=>{if(J){this.connection.removeSignatureListener(re);return}J=!0,j(ae)},"confirmed"),this.connection.getSignatureStatus(C)};return x(),{txIds:[],signedTxs:S}}else{let q=[];for(let H=0;H<S.length;H+=1){let x=await this.connection.sendTransaction(S[H],{skipPreflight:N});q.push(x)}return{txIds:q,signedTxs:S}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};var Qn=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),At=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=pe(t)}createTxBuilder(e){return this.scope.checkOwner(),new ln({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,loopMultiTxStatus:this.scope.loopMultiTxStatus,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Qn(e))}logInfo(...e){this.logger.info(Qn(e))}logAndCreateError(...e){let t=Qn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as nb}from"@solana/web3.js";import rb from"bn.js";import{AccountLayout as ub,createAssociatedTokenAccountIdempotentInstruction as cb,TOKEN_2022_PROGRAM_ID as lb,TOKEN_PROGRAM_ID as mb}from"@solana/spl-token";import{PublicKey as wm}from"@solana/web3.js";import{MintLayout as Tm,TOKEN_PROGRAM_ID as hm}from"@solana/spl-token";import{Keypair as If,PublicKey as Sf,SystemProgram as Kf,TransactionInstruction as Nf}from"@solana/web3.js";import Lf from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as vf,TOKEN_2022_PROGRAM_ID as Ef,TOKEN_PROGRAM_ID as Of}from"@solana/spl-token";import{PublicKey as Ds}from"@solana/web3.js";import wr,{isBN as Ar}from"bn.js";import{bits as Nm,BitStructure as Rm,blob as Ns,Blob as Lm,cstr as Fm,f32 as Mm,f32be as vm,f64 as Em,f64be as Om,greedy as Vm,Layout as Rs,ns64 as Wm,ns64be as Dm,nu64 as _m,nu64be as qm,offset as Ls,s16 as Gm,s16be as Um,s24 as Xm,s24be as zm,s32 as Fs,s32be as Hm,s40 as Ym,s40be as Zm,s48 as jm,s48be as Qm,s8 as Jm,seq as Ms,struct as $m,Structure as vs,u16 as Es,u16be as ed,u24 as td,u24be as nd,u32 as Os,u32be as id,u40 as rd,u40be as od,u48 as sd,u48be as ad,u8 as Vs,UInt as Ws,union as ud,Union as cd,unionLayoutDiscriminator as ld,utf8 as md}from"@solana/buffer-layout";var Jn=Rs,yr=vs;var $n=Ws;var gr=Vs,qe=Es;var ei=Os;var Ge=Fs;var Pr=Ms;var we=Ns;var ti=Ls;var Tt=class extends Jn{constructor(t,i,r){super(t,r);this.blob=we(t),this.signed=i}decode(t,i=0){let r=new wr(this.blob.decode(t,i),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,i,r=0){return typeof t=="number"&&(t=new wr(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),i,r)}};function W(n){return new $n(1,n)}function kt(n){return new $n(4,n)}function y(n){return new Tt(8,!1,n)}function se(n){return new Tt(16,!1,n)}function Tr(n){return new Tt(8,!0,n)}function kr(n){return new Tt(16,!0,n)}var at=class extends Jn{constructor(t,i,r,o){super(t.span,o);this.layout=t,this.decoder=i,this.encoder=r}decode(t,i){return this.decoder(this.layout.decode(t,i))}encode(t,i,r){return this.layout.encode(this.encoder(t),i,r)}getSpan(t,i){return this.layout.getSpan(t,i)}};function M(n){return new at(we(32),e=>new Ds(e),e=>e.toBuffer(),n)}function ii(n){return new at(gr(),_s,qs,n)}function _s(n){if(n===0)return!1;if(n===1)return!0;throw new Error("Invalid bool: "+n)}function qs(n){return n?1:0}function hr(n,e){let t=ei("length"),i=D([t,Y(n,ti(t,-t.span),"values")]);return new at(i,({values:r})=>r,r=>({values:r}),e)}function Gs(n){let e=ei("length"),t=D([e,we(ti(e,-e.span),"data")]);return new at(t,({data:i})=>i,i=>({data:i}),n)}function Ae(n){return new at(Gs(),e=>e.toString("utf-8"),e=>Buffer.from(e,"utf-8"),n)}var ni=class extends yr{decode(e,t){return super.decode(e,t)}};function D(n,e,t){return new ni(n,e,t)}function Y(n,e,t){let i,r=typeof e=="number"?e:Ar(e)?e.toNumber():new Proxy(e,{get(o,s){if(!i){let a=Reflect.get(o,"count");i=Ar(a)?a.toNumber():a,Reflect.set(o,"count",i)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(i=a),Reflect.set(o,s,a)}});return Pr(n,r,t)}import sf from"bn.js";import Ie from"bn.js";var ri=new Ie(0),Br=new Ie(1),xr=new Ie(-1),Ee=new Ie(1).shln(64),Ir=new Ie(1).shln(128),oi=Ee.sub(Br);var Us=Ir.subn(1),ht=-443636,_t=-ht,si=new Ie("4295048016"),ai=new Ie("79226673521066979257578248091"),hd=new Ie("4295048017"),Bd=new Ie("79226673521066979257578248090");var Xs=new Ie(10).pow(new Ie(6));var xd=new Ie("18446744073700000000");import Xp from"bn.js";var Rd=Buffer.from("amm_config","utf8"),Sr=Buffer.from("pool","utf8"),Cr=Buffer.from("pool_vault","utf8"),Ld=Buffer.from("pool_reward_vault","utf8"),Fd=Buffer.from("position","utf8"),Md=Buffer.from("tick_array","utf8"),vd=Buffer.from("operation","utf8"),Ed=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Od=Buffer.from("observation","utf8");function ui(n){return ge([Buffer.from("metadata","utf8"),ft.toBuffer(),n.toBuffer()],ft)}var Vd=Buffer.from("locked_position","utf8");var Wd=Buffer.from("support_mint","utf8");import{PublicKey as Pp}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Ap}from"@solana/spl-token";import kp from"bn.js";import qd from"bn.js";var mi=14;var mn=60;var js=D([we(8),W("bump"),qe("index"),M(""),kt("protocolFeeRate"),kt("tradeFeeRate"),qe("tickSpacing"),Y(y(),8,"")]),Qs=D([kt("blockTimestamp"),Tr("tickCumulative"),Y(y(),4)]),Vr=D([we(8),ii("initialized"),y("recentEpoch"),qe("observationIndex"),M("poolId"),Y(Qs,100,"observations"),Y(y(),4)]),Js=D([W("rewardState"),y("openTime"),y("endTime"),y("lastUpdateTime"),se("emissionsPerSecondX64"),y("rewardTotalEmissioned"),y("rewardClaimed"),M("tokenMint"),M("tokenVault"),M("creator"),se("rewardGrowthGlobalX64")]),vr=D([we(8),W("bump"),M("ammConfig"),M("creator"),M("mintA"),M("mintB"),M("vaultA"),M("vaultB"),M("observationId"),W("mintDecimalsA"),W("mintDecimalsB"),qe("tickSpacing"),se("liquidity"),se("sqrtPriceX64"),Ge("tickCurrent"),kt(),se("feeGrowthGlobalX64A"),se("feeGrowthGlobalX64B"),y("protocolFeesTokenA"),y("protocolFeesTokenB"),se("swapInAmountTokenA"),se("swapOutAmountTokenB"),se("swapInAmountTokenB"),se("swapOutAmountTokenA"),W("status"),Y(W(),7,""),Y(Js,3,"rewardInfos"),Y(y(),16,"tickArrayBitmap"),y("totalFeesTokenA"),y("totalFeesClaimedTokenA"),y("totalFeesTokenB"),y("totalFeesClaimedTokenB"),y("fundFeesTokenA"),y("fundFeesTokenB"),y("startTime"),Y(y(),15*4-3,"padding")]),$s=D([se("growthInsideLastX64"),y("rewardAmountOwed")]),Er=D([we(8),W("bump"),M("nftMint"),M("poolId"),Ge("tickLower"),Ge("tickUpper"),se("liquidity"),se("feeGrowthInsideLastX64A"),se("feeGrowthInsideLastX64B"),y("tokenFeesOwedA"),y("tokenFeesOwedB"),Y($s,3,"rewardInfos"),Y(y(),8,"")]),yf=D([we(8),W("bump"),M("poolId"),Ge("tickLowerIndex"),Ge("tickUpperIndex"),se("liquidity"),se("feeGrowthInsideLastX64A"),se("feeGrowthInsideLastX64B"),y("tokenFeesOwedA"),y("tokenFeesOwedB"),Y(se(),3,"rewardGrowthInside"),Y(y(),8,"")]),ea=D([Ge("tick"),kr("liquidityNet"),se("liquidityGross"),se("feeGrowthOutsideX64A"),se("feeGrowthOutsideX64B"),Y(se(),3,"rewardGrowthsOutsideX64"),Y(kt(),13,"")]),Lr=D([we(8),M("poolId"),Ge("startTickIndex"),Y(ea,mn,"ticks"),W("initializedTickCount"),Y(W(),115,"")]),ta=D([we(329),Y(M(),100,"whitelistMints")]),Zs=D([we(8),M("poolId"),Y(Y(y(),8),mi,"positiveTickArrayBitmap"),Y(Y(y(),8),mi,"negativeTickArrayBitmap")]),gf=D([y(),W("bump"),M("owner"),M("poolId"),M("positionId"),M("nftAccount"),Y(y(),8)]),na=D([we(8),W("bump"),M("lockOwner"),M("poolId"),M("positionId"),M("nftAccount"),M("lockNftMint"),y("recentEpoch"),Y(y(),8)]);Vr.span;var zf=pe("Raydium_Clmm");var sa=Buffer.from("vault_auth_seed","utf8"),jb=Buffer.from("global_config","utf8"),aa=Buffer.from("pool_vesting","utf8"),ua=Buffer.from("platform_config","utf8"),ca=Buffer.from("platform_fee_vault_auth_seed","utf8"),la=Buffer.from("creator_fee_vault_auth_seed","utf8");function Oe(n){return ge([sa],n)}function Bt(n,e,t){return ge([Sr,e.toBuffer(),t.toBuffer()],n)}function di(n,e,t){return ge([Cr,e.toBuffer(),t.toBuffer()],n)}function ut(n){return ge([Buffer.from("__event_authority","utf8")],n)}function pi(n,e){return ge([ua,e.toBuffer()],n)}function xt(n,e,t){return ge([aa,e.toBuffer(),t.toBuffer()],n)}function ct(n,e,t){return ge([e.toBuffer(),t.toBuffer()],n)}function fi(n){return ge([ca],n)}function lt(n,e,t){return ge([e.toBuffer(),t.toBuffer()],n)}function bi(n){return ge([la],n)}import{ASSOCIATED_TOKEN_PROGRAM_ID as dn,TOKEN_2022_PROGRAM_ID as pa,TOKEN_PROGRAM_ID as yi}from"@solana/spl-token";import{SystemProgram as xe,TransactionInstruction as Te}from"@solana/web3.js";import St from"bn.js";var Je=D([y(),y("epoch"),W("curveType"),qe("index"),y("migrateFee"),y("tradeFeeRate"),y("maxShareFeeRate"),y("minSupplyA"),y("maxLockRate"),y("minSellRateA"),y("minMigrateRateA"),y("minFundRaisingB"),M("mintB"),M("protocolFeeOwner"),M("migrateFeeOwner"),M("migrateToAmmWallet"),M("migrateToCpmmWallet"),Y(y(),16)]),ma=D([y("totalLockedAmount"),y("cliffPeriod"),y("unlockPeriod"),y("startTime"),y("totalAllocatedShare")]),Le=D([y(),y("epoch"),W("bump"),W("status"),W("mintDecimalsA"),W("mintDecimalsB"),W("migrateType"),y("supply"),y("totalSellA"),y("virtualA"),y("virtualB"),y("realA"),y("realB"),y("totalFundRaisingB"),y("protocolFee"),y("platformFee"),y("migrateFee"),ma.replicate("vestingSchedule"),M("configId"),M("platformId"),M("mintA"),M("mintB"),M("vaultA"),M("vaultB"),M("creator"),W("mintProgramFlag"),W("cpmmCreatorFeeOn"),y("platformVestingShare"),Y(W(),54)]),$b=D([y(),y("epoch"),M("poolId"),M("beneficiary"),y("claimedAmount"),y("tokenShareAmount"),Y(y(),8)]),Wr=D([W("migrateType"),W("migrateCpmmFeeOn"),y("supply"),y("totalSellA"),y("totalFundRaisingB"),y("totalLockedAmount"),y("cliffPeriod"),y("unlockPeriod")]),da=D([y("epoch"),W("index"),M("configId"),Wr.replicate("bondingCurveParam"),Y(y(),50)]),It=D([y(),y("epoch"),M("platformClaimFeeWallet"),M("platformLockNftWallet"),y("platformScale"),y("creatorScale"),y("burnScale"),y("feeRate"),Y(W(),64,"name"),Y(W(),256,"web"),Y(W(),256,"img"),M("cpConfigId"),y("creatorFeeRate"),M("transferFeeExtensionAuth"),M("platformVestingWallet"),y("platformVestingScale"),Y(W(),140),hr(da,"platformCurve")]);var ke={initialize:Buffer.from([175,175,109,31,13,152,155,237]),initializeV2:Buffer.from([67,153,175,39,218,16,38,32]),buyExactIn:Buffer.from([250,234,13,123,213,156,19,236]),buyExactOut:Buffer.from([24,211,116,40,105,3,153,56]),sellExactIn:Buffer.from([149,39,222,155,211,124,152,26]),sellExactOut:Buffer.from([95,200,71,34,8,9,11,166]),createVestingAccount:Buffer.from([129,178,2,13,217,172,230,218]),claimVestedToken:Buffer.from([49,33,104,30,189,157,79,35]),createPlatformConfig:Buffer.from([176,90,196,175,253,113,220,20]),claimPlatformFee:Buffer.from([156,39,208,135,76,237,61,72]),updatePlaformConfig:Buffer.from([195,60,76,129,146,45,67,143]),initializeWithToken2022:Buffer.from([37,190,126,222,44,154,171,17]),claimPlatformFeeFromVault:Buffer.from([117,241,198,168,248,218,80,29]),claimCreatorFee:Buffer.from([26,97,138,203,132,171,141,252]),updatePlatformCurveParam:Buffer.from([138,144,138,250,220,128,4,57]),removePlatformCurveParam:Buffer.from([27,30,62,169,93,224,24,145]),createPlatformVestingAccount:Buffer.from([146,71,173,69,98,19,15,106])};function Dr(n,e,t,i,r,o,s,a,c,u,l,m,d,p,f,b,g,k,w,h,A){let P=D([W("decimals"),Ae("name"),Ae("symbol"),Ae("uri")]),B=D([y("totalLockedAmount"),y("cliffPeriod"),y("unlockPeriod"),W("cpmmCreatorFeeOn")]),K=D([W("index"),y("supply"),y("totalFundRaisingB"),W("migrateType")]),I=D([W("index"),y("supply"),y("totalSellA"),y("totalFundRaisingB"),W("migrateType")]),N=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:yi,isSigner:!1,isWritable:!1},{pubkey:yi,isSigner:!1,isWritable:!1},{pubkey:ft,isSigner:!1,isWritable:!1},{pubkey:xe.programId,isSigner:!1,isWritable:!1},{pubkey:vn,isSigner:!1,isWritable:!1},{pubkey:ut(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}],R=Buffer.alloc(Buffer.from(p,"utf-8").length+Buffer.from(f,"utf-8").length+Buffer.from(b,"utf-8").length+4*3+1),v=Buffer.alloc(B.span),S=Buffer.alloc(g.type==="ConstantCurve"?I.span:K.span);return P.encode({decimals:d,name:p,symbol:f,uri:b},R),g.type==="ConstantCurve"?I.encode(Q(z({index:0},g),{migrateType:g.migrateType==="amm"?0:1}),S):g.type==="FixedCurve"?K.encode(Q(z({index:1},g),{migrateType:g.migrateType==="amm"?0:1}),S):g.type==="LinearCurve"&&K.encode(Q(z({index:2},g),{migrateType:g.migrateType==="amm"?0:1}),S),B.encode({totalLockedAmount:k,cliffPeriod:w,unlockPeriod:h,cpmmCreatorFeeOn:A},v),new Te({keys:N,programId:n,data:Buffer.from([...ke.initializeV2,...R,...S,...v])})}function _r(n,e,t,i,r,o,s,a,c,u,l,m,d,p,f,b,g,k,w,h,A){let P=D([W("decimals"),Ae("name"),Ae("symbol"),Ae("uri")]),B=D([y("totalLockedAmount"),y("cliffPeriod"),y("unlockPeriod"),W("cpmmCreatorFeeOn"),W("transferFeeExtensionParamsOption"),D([qe("transferFeeBasePoints"),y("maxinumFee")]).replicate("transferFeeExtensionParams")]),K=D([W("index"),y("supply"),y("totalFundRaisingB"),W("migrateType")]),I=D([W("index"),y("supply"),y("totalSellA"),y("totalFundRaisingB"),W("migrateType")]),N=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:pa,isSigner:!1,isWritable:!1},{pubkey:yi,isSigner:!1,isWritable:!1},{pubkey:xe.programId,isSigner:!1,isWritable:!1},{pubkey:ut(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}],R=Buffer.alloc(Buffer.from(d,"utf-8").length+Buffer.from(p,"utf-8").length+Buffer.from(f,"utf-8").length+4*3+1),v=Buffer.alloc(B.span),S=Buffer.alloc(b.type==="ConstantCurve"?I.span:K.span);return P.encode({decimals:m,name:d,symbol:p,uri:f},R),b.type==="ConstantCurve"?I.encode(Q(z({index:0},b),{migrateType:b.migrateType==="amm"?0:1}),S):b.type==="FixedCurve"?K.encode(Q(z({index:1},b),{migrateType:b.migrateType==="amm"?0:1}),S):b.type==="LinearCurve"&&K.encode(Q(z({index:2},b),{migrateType:b.migrateType==="amm"?0:1}),S),B.encode({totalLockedAmount:g,cliffPeriod:k,unlockPeriod:w,cpmmCreatorFeeOn:h,transferFeeExtensionParamsOption:A?1:0,transferFeeExtensionParams:A!=null?A:{transferFeeBasePoints:0,maxinumFee:new St(0)}},v),new Te({keys:N,programId:n,data:Buffer.from([...ke.initializeWithToken2022,...R,...S,...v])})}function qr(n,e,t,i,r,o,s,a,c,u,l,m,d,p,f,b,g,k,w,h){let A=D([y("amountB"),y("minAmountA"),y("shareFeeRate")]),P=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:ut(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}];h&&P.push({pubkey:h,isSigner:!1,isWritable:!0}),P.push({pubkey:xe.programId,isSigner:!1,isWritable:!1}),P.push({pubkey:f,isSigner:!1,isWritable:!0}),P.push({pubkey:b,isSigner:!1,isWritable:!0});let B=Buffer.alloc(A.span);return A.encode({amountB:g,minAmountA:k,shareFeeRate:w!=null?w:new St(0)},B),new Te({keys:P,programId:n,data:Buffer.from([...ke.buyExactIn,...B])})}function Gr(n,e,t,i,r,o,s,a,c,u,l,m,d,p,f,b,g,k,w,h){let A=D([y("amountA"),y("maxAmountB"),y("shareFeeRate")]),P=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:ut(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}];h&&P.push({pubkey:h,isSigner:!1,isWritable:!0}),P.push({pubkey:xe.programId,isSigner:!1,isWritable:!1}),P.push({pubkey:f,isSigner:!1,isWritable:!0}),P.push({pubkey:b,isSigner:!1,isWritable:!0});let B=Buffer.alloc(A.span);return A.encode({amountA:g,maxAmountB:k,shareFeeRate:w!=null?w:new St(0)},B),new Te({keys:P,programId:n,data:Buffer.from([...ke.buyExactOut,...B])})}function Ur(n,e,t,i,r,o,s,a,c,u,l,m,d,p,f,b,g,k,w,h){let A=D([y("amountA"),y("minAmountB"),y("shareFeeRate")]),P=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:ut(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}];h&&P.push({pubkey:h,isSigner:!1,isWritable:!0}),P.push({pubkey:xe.programId,isSigner:!1,isWritable:!1}),P.push({pubkey:f,isSigner:!1,isWritable:!0}),P.push({pubkey:b,isSigner:!1,isWritable:!0});let B=Buffer.alloc(A.span);return A.encode({amountA:g,minAmountB:k,shareFeeRate:w!=null?w:new St(0)},B),new Te({keys:P,programId:n,data:Buffer.from([...ke.sellExactIn,...B])})}function Xr(n,e,t,i,r,o,s,a,c,u,l,m,d,p,f,b,g,k,w,h){let A=D([y("amountB"),y("maxAmountA"),y("shareFeeRate")]),P=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:ut(n).publicKey,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1}];h&&P.push({pubkey:h,isSigner:!1,isWritable:!0}),P.push({pubkey:xe.programId,isSigner:!1,isWritable:!1}),P.push({pubkey:f,isSigner:!1,isWritable:!0}),P.push({pubkey:b,isSigner:!1,isWritable:!0});let B=Buffer.alloc(A.span);return A.encode({amountB:g,maxAmountA:k,shareFeeRate:w!=null?w:new St(0)},B),new Te({keys:P,programId:n,data:Buffer.from([...ke.sellExactOut,...B])})}function gi(n,e,t,i,r,o,s,a,c){let u=D([]),l=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:xe.programId,isSigner:!1,isWritable:!1},{pubkey:dn,isSigner:!1,isWritable:!1}],m=Buffer.alloc(u.span);return u.encode({},m),new Te({keys:l,programId:n,data:Buffer.from([...ke.claimVestedToken,...m])})}function Pi(n,e,t,i,r,o){let s=D([y("shareAmount")]),a=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:xe.programId,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);return s.encode({shareAmount:o},c),new Te({keys:a,programId:n,data:Buffer.from([...ke.createVestingAccount,...c])})}function wi(n,e,t,i,r,o,s,a,c){let u=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:xe.programId,isSigner:!1,isWritable:!0},{pubkey:dn,isSigner:!1,isWritable:!0}];return new Te({keys:u,programId:n,data:ke.claimPlatformFee})}function zr(n,e,t,i,r,o,s,a,c,u,l,m,d,p,f){let b=D([y("platformScale"),y("creatorScale"),y("burnScale"),y("feeRate"),Ae("name"),Ae("web"),Ae("img"),y("creatorFeeRate"),y("platformVestingScale")]),g=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:xe.programId,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1}],k=Buffer.alloc(8*6+Buffer.from(m,"utf-8").length+Buffer.from(d,"utf-8").length+Buffer.from(p,"utf-8").length+4*3);return b.encode({platformScale:c.platformScale,creatorScale:c.creatorScale,burnScale:c.burnScale,feeRate:u,name:m,web:d,img:p,creatorFeeRate:l,platformVestingScale:f},k),new Te({keys:g,programId:n,data:Buffer.from([...ke.createPlatformConfig,...k])})}function Hr(n,e,t,i){let r=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0}],o;if(i.type==="updateClaimFeeWallet"){let s=D([W("index"),M("value")]);o=Buffer.alloc(s.span),s.encode({index:0,value:i.value},o)}else if(i.type==="updateLockNftWallet"){let s=D([W("index"),M("value")]);o=Buffer.alloc(s.span),s.encode({index:1,value:i.value},o)}else if(i.type==="migrateCpLockNftScale"){let s=D([W("index"),y("platformScale"),y("creatorScale"),y("burnScale")]);o=Buffer.alloc(s.span),s.encode(z({index:2},i.value),o)}else if(i.type==="updateFeeRate"){let s=D([W("index"),y("value")]);o=Buffer.alloc(s.span),s.encode({index:3,value:i.value},o)}else if(i.type==="updateImg"||i.type==="updateName"||i.type==="updateWeb"){let s=D([W("index"),Ae("value")]);o=Buffer.alloc(Buffer.from(i.value,"utf-8").length+4+1*1),i.type==="updateName"?s.encode({index:4,value:i.value},o):i.type==="updateWeb"?s.encode({index:5,value:i.value},o):i.type==="updateImg"&&s.encode({index:6,value:i.value},o)}else if(i.type==="updateCpConfigId"){r.push({pubkey:i.value,isSigner:!1,isWritable:!1});let s=D([W("index")]);o=Buffer.alloc(s.span),s.encode({index:7},o)}else if(i.type==="updateAll"){r.push({pubkey:i.value.cpConfigId,isSigner:!1,isWritable:!1});let s=D([W("index"),M("platformClaimFeeWallet"),M("platformLockNftWallet"),y("platformScale"),y("creatorScale"),y("burnScale"),y("feeRate"),Ae("name"),Ae("web"),Ae("img"),M("transferFeeExtensionAuth"),y("creatorFeeRate"),y("platformVestingScale"),M("platformVestingWallet")]);o=Buffer.alloc(1+32+32+32+8*5+4*3+Buffer.from(i.value.name,"utf-8").length+Buffer.from(i.value.web,"utf-8").length+Buffer.from(i.value.img,"utf-8").length+32+8),s.encode({index:8,platformClaimFeeWallet:i.value.platformClaimFeeWallet,platformLockNftWallet:i.value.platformLockNftWallet,platformVestingWallet:i.value.platformVestingWallet,platformScale:i.value.migrateCpLockNftScale.platformScale,creatorScale:i.value.migrateCpLockNftScale.creatorScale,burnScale:i.value.migrateCpLockNftScale.burnScale,feeRate:i.value.feeRate,name:i.value.name,web:i.value.web,img:i.value.img,transferFeeExtensionAuth:i.value.transferFeeExtensionAuth,creatorFeeRate:i.value.creatorFeeRate,platformVestingScale:i.value.platformVestingScale},o)}else if(i.type==="updateVestingWallet"){let s=D([W("index"),M("value")]);o=Buffer.alloc(s.span),s.encode({index:9,value:i.value},o)}else if(i.type==="updatePlatformVestingScale"){let s=D([W("index"),y("value")]);o=Buffer.alloc(s.span),s.encode({index:10,value:i.value},o)}else throw Error("updateInfo params type error");return new Te({keys:r,programId:n,data:Buffer.from([...ke.updatePlaformConfig,...o])})}function Ai(n,e,t,i,r,o,s,a){let c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:xe.programId,isSigner:!1,isWritable:!1},{pubkey:dn,isSigner:!1,isWritable:!1}];return new Te({keys:c,programId:n,data:ke.claimPlatformFeeFromVault})}function Ti(n,e,t,i,r,o,s){let a=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:xe.programId,isSigner:!1,isWritable:!1},{pubkey:dn,isSigner:!1,isWritable:!1}];return new Te({keys:a,programId:n,data:ke.claimCreatorFee})}var my=new St("18446744073709551615");function Yr(n,e,t,i,r,o){let s=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:xe.programId,isSigner:!1,isWritable:!1}];return new Te({keys:s,programId:n,data:ke.createPlatformVestingAccount})}import{NATIVE_MINT as Ue,TOKEN_2022_PROGRAM_ID as mt,TOKEN_PROGRAM_ID as te,createAssociatedTokenAccountIdempotentInstruction as Be,createSyncNativeInstruction as fa,getTransferFeeConfig as Pn,unpackMint as wn}from"@solana/spl-token";import O from"bn.js";import{PublicKey as jr,SystemProgram as ba}from"@solana/web3.js";import Se from"bn.js";import pn from"bn.js";var $e=class{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){throw Error()}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){throw Error()}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){throw Error()}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){throw Error()}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){throw Error()}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){throw Error()}static buyExactIn({poolInfo:e,amount:t}){throw Error()}static buyExactOut({poolInfo:e,amount:t}){throw Error()}static sellExactIn({poolInfo:e,amount:t}){throw Error()}static sellExactOut({poolInfo:e,amount:t}){throw Error()}};var fn=class extends $e{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){return new G(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-i))}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){return new G(t.toString()).div(e.toString()).mul(10**(i-r))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){return new G(e.virtualB.add(e.realB).toString()).div(e.virtualA.sub(e.realA).toString()).mul(10**(t-i))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){return new G(r.sub(o).toString()).div(e.sub(t).sub(i).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){let r=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new G(e.virtualB.add(e.realB.add(o)).toString()).div(e.virtualA.sub(e.realA.add(r)).toString()).mul(10**(t-i))}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){if(e.lte(i))throw Error("supply need gt total sell");let s=e.sub(i).sub(r);if(s.lte(new pn(0)))throw Error("supplyMinusSellLocked <= 0");let a=t.sub(o);if(a.lte(new pn(0)))throw Error("tfMinusMf <= 0");let c=a.mul(i).mul(i).div(s),u=a.mul(i).div(s).sub(t),l=c.div(u),m=t.mul(t).div(u);if(l.lt(new pn(0))||m.lt(new pn(0)))throw Error("invalid input 0");return{a:l,b:m,c:i}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualB.add(e.realB),outputReserve:e.virtualA.sub(e.realA)})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,inputReserve:e.virtualA.sub(e.realA),outputReserve:e.virtualB.add(e.realB)})}static getAmountOut({amountIn:e,inputReserve:t,outputReserve:i}){let r=e.mul(i),o=t.add(e);return r.div(o)}static getAmountIn({amountOut:e,inputReserve:t,outputReserve:i}){let r=t.mul(e),o=i.sub(e);return ot(r,o)}};import bn from"bn.js";var yn=class extends $e{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){return new G(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-i))}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){return new G(t.toString()).div(e.toString()).mul(10**(i-r))}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){return new G(e.virtualB.toString()).div(e.virtualA.toString()).mul(10**(t-i))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){return new G(r.sub(o).toString()).div(e.sub(t).sub(i).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){let r=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new G(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(r).toString()).mul(10**(t-i))}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){let s=e.sub(r);if(s.lte(new bn(0)))throw Error("invalid input 1");let a=new bn(2).mul(t).sub(o),u=t.mul(s).div(a);if(u.lt(new bn(0))||t.lt(new bn(0)))throw Error("invalid input 0");return{a:u,b:t,c:u}}static buyExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualB,initOutput:e.virtualA})}static buyExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualB,initOutput:e.virtualA})}static sellExactIn({poolInfo:e,amount:t}){return this.getAmountOut({amountIn:t,initInput:e.virtualA,initOutput:e.virtualB})}static sellExactOut({poolInfo:e,amount:t}){return this.getAmountIn({amountOut:t,initInput:e.virtualA,initOutput:e.virtualB})}static getAmountOut({amountIn:e,initInput:t,initOutput:i}){return i.mul(e).div(t)}static getAmountIn({amountOut:e,initInput:t,initOutput:i}){let r=t.mul(e);return ot(r,i)}};import he from"bn.js";import Zr from"bn.js";var Ut=class{static _multipler(e){return new G(10).pow(e)}static getPrice({priceX64:e,decimalA:t,decimalB:i}){return new G(e.toString()).div(this._Q64).mul(this._multipler(t)).div(this._multipler(i))}static getPriceX64({price:e,decimalA:t,decimalB:i}){let r=e.mul(this._multipler(i)).div(this._multipler(t));return new Zr(r.mul(this._Q64).toFixed(0))}};Ut._Q64=new G(new Zr(1).shln(64).toString());var gn=class extends $e{static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i}){return new G(0)}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r}){return new G(0)}static getPoolPrice({poolInfo:e,decimalA:t,decimalB:i}){return new G(e.virtualA.mul(e.realA).toString()).div(Ut._Q64).mul(10**(t-i))}static getPoolEndPrice({supply:e,totalSell:t,totalLockedAmount:i,totalFundRaising:r,migrateFee:o,decimalA:s,decimalB:a}){return new G(r.sub(o).toString()).div(e.sub(t).sub(i).toString()).mul(10**(s-a))}static getPoolEndPriceReal({poolInfo:e,decimalA:t,decimalB:i}){let r=e.totalSellA.sub(e.realA),o=e.totalFundRaisingB.sub(e.realB);return new G(e.virtualB.add(e.realB).add(o).toString()).div(e.virtualA.sub(e.realA).add(r).toString()).mul(10**(t-i))}static getInitParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,migrateFee:o}){let s=e.sub(r);if(s.lte(new he(0)))throw Error("supplyMinusLocked need gt 0");let a=t.mul(new he(3)).sub(o),u=t.mul(new he(2)).mul(s).div(a),l=u.mul(u),m=t.mul(new he(2)).mul(Ee).div(l);if(!m.gt(new he(0)))throw Error("a need gt 0");if(!oi.gt(m))throw Error("a need lt u64 max");if(m.lt(new he(0))||u.lt(new he(0)))throw Error("invalid input 0");return{a:m,b:new he(0),c:u}}static buyExactIn({poolInfo:e,amount:t}){let i=e.realB.add(t),r=new he(2).mul(i).mul(Ee).div(e.virtualA);return new he(new G(r.toString()).sqrt().toFixed(0)).sub(e.realA)}static buyExactOut({poolInfo:e,amount:t}){let i=e.realA.add(t),r=i.mul(i);return ot(e.virtualA.mul(r),new he(2).mul(Ee)).sub(e.realB)}static sellExactIn({poolInfo:e,amount:t}){let i=e.realA.sub(t),r=i.mul(i),o=ot(e.virtualA.mul(r),new he(2).mul(Ee));return e.realB.sub(o)}static sellExactOut({poolInfo:e,amount:t}){let i=e.realB.sub(t),r=new he(2).mul(i).mul(Ee).div(e.virtualA),o=new he(new G(r.toString()).sqrt().toFixed(0));return e.realA.sub(o)}};var Ce=class{static getPoolCurvePointByPoolInfo({curveType:e,pointCount:t,poolInfo:i}){return this.getPoolCurvePointByInit({curveType:e,pointCount:t,supply:i.supply,totalFundRaising:i.totalFundRaisingB,totalSell:i.totalSellA,totalLockedAmount:i.vestingSchedule.totalLockedAmount,migrateFee:i.migrateFee,decimalA:i.mintDecimalsA,decimalB:i.mintDecimalsB})}static getPoolCurvePointByInit({curveType:e,pointCount:t,supply:i,totalFundRaising:r,totalSell:o,totalLockedAmount:s,migrateFee:a,decimalA:c,decimalB:u}){if(t<3)throw Error("point count < 3");let l=this.getCurve(e),m=l.getInitParam({supply:i,totalFundRaising:r,totalSell:o,totalLockedAmount:s,migrateFee:a}),d=l.getPoolInitPriceByInit(Q(z({},m),{decimalA:c,decimalB:u})),p=r.div(new Se(t-1)),f=new Se(0),b=[{price:d,totalSellSupply:0}],{a:g,b:k}=m,w=f,h=f;for(let A=1;A<t;A++){let P=A!==t-1?p:r.sub(h),B=this.buyExactIn({poolInfo:{virtualA:g,virtualB:k,realA:w,realB:h,totalFundRaisingB:r,totalSellA:o},amountB:P,protocolFeeRate:f,platformFeeRate:f,curveType:e,shareFeeRate:f,creatorFeeRate:f,transferFeeConfigA:void 0,slot:0});w=w.add(B.amountA.amount),h=h.add(B.amountB);let K=this.getPrice({poolInfo:{virtualA:g,virtualB:k,realA:w,realB:h},decimalA:c,decimalB:u,curveType:e});b.push({price:K,totalSellSupply:new G(w.toString()).div(10**c).toNumber()})}return b}static getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i,curveType:r}){return this.getCurve(r).getPoolInitPriceByPool({poolInfo:e,decimalA:t,decimalB:i})}static getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r,curveType:o}){return this.getCurve(o).getPoolInitPriceByInit({a:e,b:t,decimalA:i,decimalB:r})}static getPrice({poolInfo:e,curveType:t,decimalA:i,decimalB:r}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:i,decimalB:r})}static getEndPrice({poolInfo:e,curveType:t,decimalA:i,decimalB:r}){return this.getCurve(t).getPoolPrice({poolInfo:e,decimalA:i,decimalB:r})}static getPoolEndPriceReal({poolInfo:e,curveType:t,decimalA:i,decimalB:r}){return this.getCurve(t).getPoolEndPriceReal({poolInfo:e,decimalA:i,decimalB:r})}static checkParam({supply:e,totalFundRaising:t,totalSell:i,totalLockedAmount:r,decimals:o,config:s,migrateType:a}){if(Number(o)!==6)throw Error("decimals = 6");if(e.mul(s.maxLockRate).div(st).lt(r))throw Error("total lock amount gte max lock amount");if(e.lt(s.minSupplyA.mul(new Se(10**o))))throw Error("supply lt min supply");let u=e.mul(s.minSellRateA).div(st);if(i.lt(u))throw Error("invalid input");if(t.lt(s.minFundRaisingB))throw Error("total fund raising lt min fund raising");let l=e.sub(i).sub(r),m=e.mul(s.minMigrateRateA).div(st);if(l.lt(m))throw Error("migrate lt min migrate amoount");let d=e.sub(i).sub(r),p=new Se(new G(d.mul(t).toString()).sqrt().toFixed(0));if(a==="amm"){let f=new Se(10).pow(new Se(o));if(p.lte(f))throw Error("check migrate lp error")}else if(a==="cpmm"){let f=new Se(100);if(p.lte(f))throw Error("check migrate lp error")}else throw Error("migrate type error")}static buyExactIn({poolInfo:e,amountB:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let l=this.totalFeeRate({protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s,creatorFeeRate:a}),m=this.calculateFee({amount:t,feeRate:l}),d=t.sub(m),p=this.getCurve(o),f=p.buyExactIn({poolInfo:e,amount:d}),b=e.totalSellA.sub(e.realA),g,k,w;if(f.gt(b)){g=b;let A=p.buyExactOut({poolInfo:e,amount:g});k=this.calculatePreFee({postFeeAmount:A,feeRate:l}),w=k.sub(A)}else g=f,k=t,w=m;let h=this.splitFee({totalFee:w,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s,creatorFeeRate:a});return{amountA:Gn(g,c,u),amountB:k,splitFee:h}}static buyExactOut({poolInfo:e,amountA:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let l=e.totalSellA.sub(e.realA),m=Un(t,c,u),d=m.fee?m.amount.add(m.fee):m.amount;t.gt(l)&&(d=l);let f=this.getCurve(o).buyExactOut({poolInfo:e,amount:d}),b=this.totalFeeRate({protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s,creatorFeeRate:a}),g=this.calculatePreFee({postFeeAmount:f,feeRate:b}),k=g.sub(f),w=this.splitFee({totalFee:k,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s,creatorFeeRate:a});return{amountA:m,amountB:g,splitFee:w}}static sellExactIn({poolInfo:e,amountA:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let l=this.getCurve(o),m=Gn(t,c,u),d=m.fee?m.amount.sub(m.fee):m.amount,p=l.sellExactIn({poolInfo:e,amount:d}),f=this.calculateFee({amount:p,feeRate:this.totalFeeRate({protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s,creatorFeeRate:a})}),b=this.splitFee({totalFee:f,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s,creatorFeeRate:a});return{amountA:m,amountB:p.sub(f),splitFee:b}}static sellExactOut({poolInfo:e,amountB:t,protocolFeeRate:i,platformFeeRate:r,curveType:o,shareFeeRate:s,creatorFeeRate:a,transferFeeConfigA:c,slot:u}){let l=this.totalFeeRate({protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s,creatorFeeRate:a}),m=this.calculatePreFee({postFeeAmount:t,feeRate:l});if(e.realB.lt(m))throw Error("Insufficient liquidity");let d=m.sub(t),f=Ce.getCurve(o).sellExactOut({poolInfo:e,amount:m});if(f.gt(e.realA))throw Error();let b=this.splitFee({totalFee:d,protocolFeeRate:i,platformFeeRate:r,shareFeeRate:s,creatorFeeRate:a});return{amountA:Un(f,c,u),amountB:t,splitFee:b}}static splitFee({totalFee:e,protocolFeeRate:t,platformFeeRate:i,shareFeeRate:r,creatorFeeRate:o}){let s=this.totalFeeRate({protocolFeeRate:t,platformFeeRate:i,shareFeeRate:r,creatorFeeRate:o}),a=s.isZero()?new Se(0):e.mul(i).div(s),c=s.isZero()?new Se(0):e.mul(r).div(s),u=s.isZero()?new Se(0):e.mul(o).div(s),l=e.sub(a).sub(c).sub(u);return{platformFee:a,shareFee:c,protocolFee:l,creatorFee:u}}static calculateFee({amount:e,feeRate:t}){return ar(e,t,st)}static calculatePreFee({postFeeAmount:e,feeRate:t}){if(t.isZero())return e;let i=e.mul(st),r=st.sub(t);return i.add(r).sub(new Se(1)).div(r)}static totalFeeRate({protocolFeeRate:e,platformFeeRate:t,shareFeeRate:i,creatorFeeRate:r}){if(e.add(t).add(i).add(r).gt(new Se(1e6)))throw Error("total fee rate gt 1_000_000");return e.add(t).add(i).add(r)}static getCurve(e){switch(e){case 0:return fn;case 1:return yn;case 2:return gn}throw Error("find curve error")}};var An={initPriceX64:new O("515752397214619"),supply:new O(1e15),totalSellA:new O(7931e11),totalFundRaisingB:new O(85e9),totalFundRaisingBUSD:new O(125e8),totalLockedAmount:new O("0"),cliffPeriod:new O("0"),unlockPeriod:new O("0"),decimals:6,virtualA:new O("1073471847374405"),virtualB:new O("30050573465"),realA:new O(0),realB:new O(0),protocolFee:new O(0),platformId:new jr("4Bu96XjU84XjPDSpveTVf6LYGCkfW5FK7SNkREWcEfV4"),vestingSchedule:{totalLockedAmount:new O(0),cliffPeriod:new O(0),unlockPeriod:new O(0),startTime:new O(0),totalAllocatedShare:new O(0)}},et=new O(1e4),Ng=new Set(["USDCoctVLVnvTXBEuP9s8hntucdJokbo17RwHuNXemT","USD1ttGY1N17NEEHLmELoaybftRBUSErhqYiQzvEmuB"]),ki=class extends At{constructor(e){super(e)}async createLaunchpad(q){var H=q,{programId:e=le,authProgramId:t,platformId:i=An.platformId,mintA:r,decimals:o=6,mintBDecimals:s=9,name:a,symbol:c,uri:u,migrateType:l,configId:m,configInfo:d,platformFeeRate:p,platformVestingScale:f,txVersion:b,computeBudgetConfig:g,txTipConfig:k,feePayer:w,buyAmount:h,minMintAAmount:A,slippage:P,associatedOnly:B=!0,checkCreateATAOwner:K=!1,extraSigners:I,token2022:N,transferFeeExtensionParams:R,creatorFeeOn:v=0}=H,S=nt(H,["programId","authProgramId","platformId","mintA","decimals","mintBDecimals","name","symbol","uri","migrateType","configId","configInfo","platformFeeRate","platformVestingScale","txVersion","computeBudgetConfig","txTipConfig","feePayer","buyAmount","minMintAAmount","slippage","associatedOnly","checkCreateATAOwner","extraSigners","token2022","transferFeeExtensionParams","creatorFeeOn"]);var Ii,Si,Ci,Ki,Ni,Ri,Li,Fi,Mi,vi,Ei;let x=this.createTxBuilder(w);t=t!=null?t:Oe(e).publicKey,N=!!R,N&&(l="cpmm");let C=d;if(!C&&m){let We=await this.scope.connection.getAccountInfo(m);We&&(C=Je.decode(We.data))}C||this.logAndCreateError("config not found");let J=C.mintB,$=C.curveType,{publicKey:re}=Bt(e,r,J),{publicKey:j}=di(e,re,r),{publicKey:ae}=di(e,re,J),{publicKey:ue}=ui(r);this.logDebug(`create token: ${r.toBase58()}, mintB: ${J.toBase58()}, decimals A:${o}/B:${s}, config:${m.toBase58()}`),c.length>10&&this.logAndCreateError("Symbol length should shorter than 11"),u||this.logAndCreateError("uri should not empty");let Z=(await this.scope.api.fetchLaunchConfigs()).find(We=>We.key.pubKey===m.toBase58()),X=(Ii=S==null?void 0:S.supply)!=null?Ii:new O(Z.defaultParams.supplyInit),ye=(Si=S==null?void 0:S.totalSellA)!=null?Si:new O(Z.defaultParams.totalSellA),tt=(Ci=S==null?void 0:S.totalFundRaisingB)!=null?Ci:new O(Z.defaultParams.totalFundRaisingB),ne=(Ki=S==null?void 0:S.totalLockedAmount)!=null?Ki:new O(0),Xe=await this.scope.connection.getAccountInfo(i);Xe||this.logAndCreateError("platform id not found:",i.toString());let hi=It.decode(Xe.data),Tn=hi.platformVestingScale,Bi=hi.feeRate,xi=Ce.getCurve(C.curveType).getInitParam({supply:X,totalFundRaising:tt,totalSell:ye,totalLockedAmount:ne,migrateFee:C.migrateFee}),Xt;try{Xt=await this.scope.token.getTokenInfo(J)}catch{this.logDebug("can not get mintB info from getTokenInfo")}let Ve={epoch:new O(896),bump:254,status:0,mintDecimalsA:o,mintDecimalsB:(Ni=Xt==null?void 0:Xt.decimals)!=null?Ni:s,supply:X,totalSellA:ye,mintA:new jr(r),mintB:J,virtualA:xi.a,virtualB:xi.b,realA:An.realA,realB:An.realB,migrateFee:C.migrateFee,migrateType:l==="amm"?0:1,protocolFee:An.protocolFee,platformFee:Bi,platformId:i,configId:m,vaultA:j,vaultB:ae,creator:this.scope.ownerPubKey,totalFundRaisingB:tt,vestingSchedule:{totalLockedAmount:ne,cliffPeriod:new O(0),unlockPeriod:new O(0),startTime:new O(0),totalAllocatedShare:new O(0)},mintProgramFlag:N?1:0,cpmmCreatorFeeOn:v,platformVestingShare:Tn!=null?Tn:new O(0)},Qr=Ce.getCurve(C.curveType),{c:Jr}=Qr.getInitParam({supply:Ve.supply,totalFundRaising:Ve.totalFundRaisingB,totalLockedAmount:ne,totalSell:C.curveType===0?Ve.totalSellA:new O(0),migrateFee:C.migrateFee});try{Ce.checkParam({supply:Ve.supply,totalFundRaising:Ve.totalFundRaisingB,totalSell:Jr,totalLockedAmount:ne,decimals:Ve.mintDecimalsA,config:C,migrateType:l}),this.logDebug("check init params success")}catch(We){this.logAndCreateError(`check create mint params failed, ${We.message}`)}x.addInstruction({instructions:[N?_r(e,w!=null?w:this.scope.ownerPubKey,this.scope.ownerPubKey,m,i,t,re,r,J,j,ae,o,a,c,u||"https://",{type:$===0?"ConstantCurve":$===1?"FixedCurve":$===2?"LinearCurve":"ConstantCurve",totalSellA:ye,migrateType:l,supply:X,totalFundRaisingB:tt},ne,(Ri=S==null?void 0:S.cliffPeriod)!=null?Ri:new O(0),(Li=S==null?void 0:S.unlockPeriod)!=null?Li:new O(0),v,R):Dr(e,w!=null?w:this.scope.ownerPubKey,this.scope.ownerPubKey,m,i,t,re,r,J,j,ae,ue,o,a,c,u||"https://",{type:$===0?"ConstantCurve":$===1?"FixedCurve":$===2?"LinearCurve":"ConstantCurve",totalSellA:ye,migrateType:l,supply:X,totalFundRaisingB:tt},ne,(Fi=S==null?void 0:S.cliffPeriod)!=null?Fi:new O(0),(Mi=S==null?void 0:S.unlockPeriod)!=null?Mi:new O(0),v)]});let kn=N?await this.scope.connection.getEpochInfo():void 0,zt=R?{epoch:BigInt((kn==null?void 0:kn.epoch)||0),maximumFee:BigInt((vi=R==null?void 0:R.maxinumFee.toString())!=null?vi:0),transferFeeBasisPoints:(Ei=R==null?void 0:R.transferFeeBasePoints)!=null?Ei:0}:void 0,hn={amountA:{amount:new O(0),fee:void 0,expirationTime:void 0},amountB:new O(0),splitFee:{platformFee:new O(0),shareFee:new O(0),protocolFee:new O(0),creatorFee:new O(0)}},Bn;if(I!=null&&I.length&&x.addInstruction({signers:I}),!S.createOnly){let{builder:We,extInfo:$r}=await this.buyToken({programId:e,authProgramId:t,mintAProgram:N?mt:void 0,mintA:r,mintB:J,poolInfo:Ve,buyAmount:h,minMintAAmount:A,shareFeeRate:S.shareFeeRate,shareFeeReceiver:S.shareFeeReceiver,configInfo:C,platformFeeRate:Bi,slippage:P,associatedOnly:B,checkCreateATAOwner:K,skipCheckMintA:!zt,transferFeeConfigA:zt?{transferFeeConfigAuthority:t,withdrawWithheldAuthority:t,withheldAmount:BigInt(0),olderTransferFee:zt,newerTransferFee:zt}:void 0,fromCreate:!0});x.addInstruction(z({},We.AllTxData)),hn=z({},$r),Bn=(this.scope.cluster==="devnet"||b===1)&&S.shareFeeReceiver?[We.allInstructions[0]]:void 0}return x.addTipInstruction(k),b===0?x.sizeCheckBuildV0({computeBudgetConfig:g,swapInfo:hn,splitIns:Bn,address:Q(z({},Ve),{poolId:re})}):x.sizeCheckBuild({computeBudgetConfig:g,swapInfo:hn,splitIns:Bn,address:Q(z({},Ve),{poolId:re})})}async buyToken({programId:e=le,authProgramId:t,mintA:i,mintAProgram:r=te,mintB:o=Ue,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:l,txTipConfig:m,feePayer:d,buyAmount:p,minMintAAmount:f,slippage:b,shareFeeRate:g=new O(0),shareFeeReceiver:k,associatedOnly:w=!0,checkCreateATAOwner:h=!1,fromCreate:A=!1,transferFeeConfigA:P,skipCheckMintA:B=!1}){var X,ye,tt;p.lte(new O(0))&&this.logAndCreateError("buy amount should gt 0:",p.toString());let K=this.createTxBuilder(d),{publicKey:I}=Bt(e,i,o);t=t!=null?t:Oe(e).publicKey;let N=P;if(!B)if(N)r=mt;else{let ne=await this.scope.connection.getAccountInfo(i);if(ne&&ne.owner.equals(mt)){r=ne.owner;let Xe=wn(i,ne,r);N=Pn(Xe)||void 0}}let R=this.scope.account.getAssociatedTokenAccount(i,r),v=o.equals(Ue),S=A&&v,q=S?this.scope.account.getAssociatedTokenAccount(o,te):null,H=v;if(K.addInstruction({instructions:[Be(this.scope.ownerPubKey,R,this.scope.ownerPubKey,i,r),...S?[Be(this.scope.ownerPubKey,q,this.scope.ownerPubKey,o,te),ba.transfer({fromPubkey:this.scope.ownerPubKey,toPubkey:q,lamports:BigInt(p.toString())}),fa(q)]:[]]}),!S){let{account:ne,instructionParams:Xe}=await this.scope.account.getOrCreateTokenAccount({mint:o,owner:this.scope.ownerPubKey,createInfo:H?{payer:this.scope.ownerPubKey,amount:p}:void 0,skipCloseAccount:!H,notUseTokenAccount:H,associatedOnly:H?!1:w,checkCreateATAOwner:h});ne&&(q=ne),K.addInstruction(Xe||{})}q||this.logAndCreateError(`cannot found mintB(${o.toBase58()}) buy token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let x=s;if(!x){let ne=await this.scope.connection.getAccountInfo(I,{commitment:"processed"});ne||this.logAndCreateError("cannot found pool:",I.toBase58()),x=Le.decode(ne.data)}let C=a,J=await _e(this.scope.connection,[C?void 0:x.configId,x.platformId].filter(Boolean).map(ne=>({pubkey:ne})));if(!C){let ne=J.find(Xe=>Xe.pubkey.equals(x.configId));(!ne||!ne.accountInfo)&&this.logAndCreateError("config not found: ",x.configId.toBase58()),C=Je.decode(ne.accountInfo.data)}let $=J.find(ne=>ne.pubkey.equals(x.platformId));(!$||!$.accountInfo)&&this.logAndCreateError("platform info not found: ",x.configId.toBase58());let re=It.decode($.accountInfo.data);c=c||re.feeRate;let j=Ce.buyExactIn({poolInfo:x,amountB:p,protocolFeeRate:C.tradeFeeRate,platformFeeRate:c,curveType:C.curveType,shareFeeRate:g,creatorFeeRate:re.creatorFeeRate,transferFeeConfigA:N,slot:await this.scope.connection.getSlot()}),ae=new G(j.amountA.amount.toString()).sub((ye=(X=j.amountA.fee)==null?void 0:X.toString())!=null?ye:0),ue=b?new G(et.sub(b).toNumber()/et.toNumber()).clampedTo(0,1):new G(1),de=f!=null?f:b?new O(ae.mul(ue).toFixed(0)):j.amountA.amount.sub((tt=j.amountA.fee)!=null?tt:new O(0));j.amountB.lt(p)&&console.log(`maximum ${i.toBase58()} amount can buy is ${j.amountA.toString()}, input ${o.toBase58()} amount: ${j.amountB.toString()}`);let Z=k?Re(k,o,te).publicKey:void 0;return Z&&K.addInstruction({instructions:[Be(this.scope.ownerPubKey,Z,k,o)]}),K.addInstruction({instructions:[qr(e,this.scope.ownerPubKey,t,x.configId,x.platformId,I,R,q,x.vaultA,x.vaultB,i,o,r,te,ct(e,x.platformId,o).publicKey,lt(e,x.creator,o).publicKey,j.amountB.lt(p)?j.amountB:p,de,g,Z)]}),K.addCustomComputeBudget(l),K.addTipInstruction(m),K.versionBuild({txVersion:u,extInfo:Q(z({},j),{decimalOutAmount:ae,minDecimalOutAmount:new G(de.toString())})})}async buyTokenExactOut({programId:e=le,authProgramId:t,mintA:i,mintAProgram:r=te,mintB:o=Ue,poolInfo:s,configInfo:a,transferFeeConfigA:c,platformFeeRate:u,txVersion:l,computeBudgetConfig:m,txTipConfig:d,feePayer:p,maxBuyAmount:f,outAmount:b,slippage:g,shareFeeRate:k=new O(0),shareFeeReceiver:w,associatedOnly:h=!0,checkCreateATAOwner:A=!1,skipCheckMintA:P=!1}){b.lte(new O(0))&&this.logAndCreateError("out amount should gt 0:",b.toString());let B=this.createTxBuilder(p),{publicKey:K}=Bt(e,i,o);t=t!=null?t:Oe(e).publicKey;let I=s;if(!I){let Z=await this.scope.connection.getAccountInfo(K,{commitment:"processed"});Z||this.logAndCreateError("cannot found pool:",K.toBase58()),I=Le.decode(Z.data)}let N=a,R=await _e(this.scope.connection,[N?void 0:I.configId,I.platformId].filter(Boolean).map(Z=>({pubkey:Z})));if(!N){let Z=R.find(X=>X.pubkey.equals(I.configId));(!Z||!Z.accountInfo)&&this.logAndCreateError("config not found: ",I.configId.toBase58()),N=Je.decode(Z.accountInfo.data)}let v=R.find(Z=>Z.pubkey.equals(I.platformId));(!v||!v.accountInfo)&&this.logAndCreateError("platform info not found: ",I.configId.toBase58());let S=It.decode(v.accountInfo.data);u=u||S.feeRate;let q=c;if(!P)if(q)r=mt;else{let Z=await this.scope.connection.getAccountInfo(i);if(Z&&Z.owner.equals(mt)){r=Z.owner;let X=wn(i,Z,r);q=Pn(X)||void 0}}let H=Ce.buyExactOut({poolInfo:I,amountA:b,protocolFeeRate:N.tradeFeeRate,platformFeeRate:u,curveType:N.curveType,shareFeeRate:k,creatorFeeRate:S.creatorFeeRate,transferFeeConfigA:q,slot:await this.scope.connection.getSlot()}),x=new G(H.amountB.toString()),C=g?new G(et.add(g).toNumber()/et.toNumber()).clampedTo(0,Number.MIN_SAFE_INTEGER):new G(1),J=(f!=null?f:g)?new O(x.mul(C).toFixed(0)):H.amountB,$=this.scope.account.getAssociatedTokenAccount(i,r),re=null,j=o.equals(Ue);B.addInstruction({instructions:[Be(this.scope.ownerPubKey,$,this.scope.ownerPubKey,i,r)]});let{account:ae,instructionParams:ue}=await this.scope.account.getOrCreateTokenAccount({mint:o,owner:this.scope.ownerPubKey,createInfo:j?{payer:this.scope.ownerPubKey,amount:H.amountB}:void 0,skipCloseAccount:!j,notUseTokenAccount:j,associatedOnly:j?!1:h,checkCreateATAOwner:A});ae&&(re=ae),B.addInstruction(ue||{}),re===void 0&&this.logAndCreateError(`cannot found mintB(${o.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts);let de=w?Re(w,o,te).publicKey:void 0;return de&&B.addInstruction({instructions:[Be(this.scope.ownerPubKey,de,w,o)]}),B.addInstruction({instructions:[Gr(e,this.scope.ownerPubKey,t,I.configId,I.platformId,K,$,re,I.vaultA,I.vaultB,i,o,r,te,ct(e,I.platformId,o).publicKey,lt(e,I.creator,o).publicKey,b,J,k,de)]}),B.addCustomComputeBudget(m),B.addTipInstruction(d),B.versionBuild({txVersion:l,extInfo:{maxSpentAmount:J,outAmount:b}})}async sellToken({programId:e=le,authProgramId:t,mintAProgram:i=te,mintA:r,mintB:o=Ue,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:l,txTipConfig:m,feePayer:d,sellAmount:p,minAmountB:f,slippage:b,shareFeeRate:g=new O(0),shareFeeReceiver:k,associatedOnly:w=!0,checkCreateATAOwner:h=!1,skipCheckMintA:A=!1}){t=t!=null?t:Oe(e).publicKey;let P=this.createTxBuilder(d);p.lte(new O(0))&&this.logAndCreateError("sell amount should be gt 0");let{publicKey:B}=Bt(e,r,o),K;if(!A){let X=await this.scope.connection.getAccountInfo(r);if(X&&X.owner.equals(mt)){i=X.owner;let ye=wn(r,X,i);K=Pn(ye)||void 0}}let I=null,N=null,R=o.equals(Ue),{account:v,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:i,mint:r,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:w,checkCreateATAOwner:h});v&&(I=v),P.addInstruction(S||{}),I===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:q,instructionParams:H}=await this.scope.account.getOrCreateTokenAccount({mint:o,owner:this.scope.ownerPubKey,createInfo:R?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!R,notUseTokenAccount:R,associatedOnly:R?!1:w,checkCreateATAOwner:h});q&&(N=q),P.addInstruction(H||{}),N===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let x=s;if(!x){let X=await this.scope.connection.getAccountInfo(B,{commitment:"processed"});X||this.logAndCreateError("cannot found pool",B.toBase58()),x=Le.decode(X.data)}let C=a,J=await _e(this.scope.connection,[C?void 0:x.configId,x.platformId].filter(Boolean).map(X=>({pubkey:X})));if(!C){let X=J.find(ye=>ye.pubkey.equals(x.configId));(!X||!X.accountInfo)&&this.logAndCreateError("config not found: ",x.configId.toBase58()),C=Je.decode(X.accountInfo.data)}let $=J.find(X=>X.pubkey.equals(x.platformId));(!$||!$.accountInfo)&&this.logAndCreateError("platform info not found: ",x.configId.toBase58());let re=It.decode($.accountInfo.data);c=c||re.feeRate;let j=Ce.sellExactIn({poolInfo:x,amountA:p,protocolFeeRate:C.tradeFeeRate,platformFeeRate:c,curveType:C.curveType,shareFeeRate:g,creatorFeeRate:re.creatorFeeRate,transferFeeConfigA:K,slot:await this.scope.connection.getSlot()}),ae=new G(j.amountB.toString()),ue=b?new G(et.sub(b).toNumber()/et.toNumber()).clampedTo(0,1):new G(1),de=f!=null?f:b?new O(ae.mul(ue).toFixed(0)):j.amountB;de.lte(new O(0))&&this.logAndCreateError(`out ${o.toBase58()} amount should be gt 0`);let Z=k?Re(k,o,te).publicKey:void 0;return Z&&P.addInstruction({instructions:[Be(this.scope.ownerPubKey,Z,k,o)]}),P.addInstruction({instructions:[Ur(e,this.scope.ownerPubKey,t,x.configId,x.platformId,B,I,N,x.vaultA,x.vaultB,r,o,i,te,ct(e,x.platformId,o).publicKey,lt(e,x.creator,o).publicKey,j.amountA.amount.lt(p)?j.amountA.amount:p,de,g,Z)]}),P.addCustomComputeBudget(l),P.addTipInstruction(m),P.versionBuild({txVersion:u,extInfo:{outAmount:de}})}async sellTokenExactOut({programId:e=le,authProgramId:t,mintAProgram:i=te,mintA:r,mintB:o=Ue,poolInfo:s,configInfo:a,platformFeeRate:c,txVersion:u,computeBudgetConfig:l,txTipConfig:m,feePayer:d,inAmount:p,maxSellAmount:f,slippage:b,shareFeeRate:g=new O(0),shareFeeReceiver:k,associatedOnly:w=!0,checkCreateATAOwner:h=!1,skipCheckMintA:A=!1}){t=t!=null?t:Oe(e).publicKey;let P=this.createTxBuilder(d);f!=null&&f.lte(new O(0))&&this.logAndCreateError("max sell amount should be gt 0");let{publicKey:B}=Bt(e,r,o),K;if(!A){let X=await this.scope.connection.getAccountInfo(r);if(X&&X.owner.equals(mt)){i=X.owner;let ye=wn(r,X,i);K=Pn(ye)||void 0}}let I=null,N=null,R=o.equals(Ue),{account:v,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:i,mint:r,owner:this.scope.ownerPubKey,createInfo:void 0,skipCloseAccount:!0,notUseTokenAccount:!1,associatedOnly:w,checkCreateATAOwner:h});v&&(I=v),P.addInstruction(S||{}),I===void 0&&this.logAndCreateError("cannot found mintA token accounts","tokenAccounts",this.scope.account.tokenAccounts);let{account:q,instructionParams:H}=await this.scope.account.getOrCreateTokenAccount({mint:o,owner:this.scope.ownerPubKey,createInfo:R?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!R,notUseTokenAccount:R,associatedOnly:R?!1:w,checkCreateATAOwner:h});q&&(N=q),P.addInstruction(H||{}),N===void 0&&this.logAndCreateError("cannot found mintB token accounts","tokenAccounts",this.scope.account.tokenAccounts);let x=s;if(!x){let X=await this.scope.connection.getAccountInfo(B,{commitment:"processed"});X||this.logAndCreateError("cannot found pool",B.toBase58()),x=Le.decode(X.data)}let C=a,J=await _e(this.scope.connection,[C?void 0:x.configId,x.platformId].filter(Boolean).map(X=>({pubkey:X})));if(!C){let X=J.find(ye=>ye.pubkey.equals(x.configId));(!X||!X.accountInfo)&&this.logAndCreateError("config not found: ",x.configId.toBase58()),C=Je.decode(X.accountInfo.data)}let $=J.find(X=>X.pubkey.equals(x.platformId));(!$||!$.accountInfo)&&this.logAndCreateError("platform info not found: ",x.configId.toBase58());let re=It.decode($.accountInfo.data);c=c||re.feeRate;let j=Ce.sellExactOut({poolInfo:x,amountB:p,protocolFeeRate:C.tradeFeeRate,platformFeeRate:c,curveType:C.curveType,shareFeeRate:g,creatorFeeRate:re.creatorFeeRate,transferFeeConfigA:K,slot:await this.scope.connection.getSlot()}),ae=new G(j.amountA.amount.toString()),ue=b?new G(et.add(b).toNumber()/et.toNumber()).clampedTo(0,Number.MAX_SAFE_INTEGER):new G(1),de=(f!=null?f:b)?new O(ae.mul(ue).toFixed(0)):j.amountA.amount,Z=k?Re(k,o,te).publicKey:void 0;return Z&&P.addInstruction({instructions:[Be(this.scope.ownerPubKey,Z,k,o)]}),P.addInstruction({instructions:[Xr(e,this.scope.ownerPubKey,t,x.configId,x.platformId,B,I,N,x.vaultA,x.vaultB,r,o,i,te,ct(e,x.platformId,o).publicKey,lt(e,x.creator,o).publicKey,p,de,g,Z)]}),P.addCustomComputeBudget(l),P.addTipInstruction(m),P.versionBuild({txVersion:u,extInfo:{maxSellAmount:de}})}async createPlatformConfig({programId:e=le,platformAdmin:t,platformClaimFeeWallet:i,platformLockNftWallet:r,platformVestingWallet:o,cpConfigId:s,migrateCpLockNftScale:a,transferFeeExtensionAuth:c,creatorFeeRate:u,feeRate:l,name:m,web:d,img:p,platformVestingScale:f=new O(0),txVersion:b,computeBudgetConfig:g,txTipConfig:k,feePayer:w}){let h=this.createTxBuilder(w),{publicKey:A}=pi(e,t);return h.addInstruction({instructions:[zr(e,t,i,r,o,A,s,c,a,l,u,m,d,p,f)]}),h.addCustomComputeBudget(g),h.addTipInstruction(k),h.versionBuild({txVersion:b,extInfo:{platformId:A}})}async updatePlatformConfig({programId:e=le,platformAdmin:t,platformId:i,updateInfo:r,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),l=i!=null?i:pi(e,t).publicKey;return u.addInstruction({instructions:[Hr(e,t,l,r)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:o})}async createPlatformVestingAccount({programId:e=le,platformVestingWallet:t,beneficiary:i,platformId:r,poolId:o,vestingRecord:s,txVersion:a,computeBudgetConfig:c,txTipConfig:u,feePayer:l}){let m=this.createTxBuilder(l),d=s!=null?s:xt(e,o,i).publicKey;return m.addInstruction({instructions:[Yr(e,t,i,r,o,d)]}),m.addCustomComputeBudget(c),m.addTipInstruction(u),m.versionBuild({txVersion:a})}async claimPlatformFee({programId:e=le,authProgramId:t,platformId:i,poolId:r,platformClaimFeeWallet:o,mintB:s,vaultB:a,mintBProgram:c=te,txVersion:u,computeBudgetConfig:l,txTipConfig:m,feePayer:d}){var k;let p=this.createTxBuilder(d);t=t!=null?t:Oe(e).publicKey;let f=s,b=a;if(!f){let w=await this.scope.connection.getAccountInfo(r,{commitment:"processed"});w||this.logAndCreateError("cannot found pool:",r.toBase58());let h=Le.decode(w.data),A=await this.scope.connection.getAccountInfo(h.configId,{commitment:"processed"});A||this.logAndCreateError("cannot found config:",h.configId.toBase58()),f=Je.decode(A.data).mintB,b=b!=null?b:h.vaultB}(!f||!b)&&this.logAndCreateError("cannot found mint info, mintB: ",f.toBase58(),", vaultB: ",(k=b==null?void 0:b.toBase58())!=null?k:"");let g=Re(this.scope.ownerPubKey,f,te).publicKey;return p.addInstruction({instructions:[Be(this.scope.ownerPubKey,g,this.scope.ownerPubKey,f)]}),p.addInstruction({instructions:[wi(e,o,t,r,i,b,g,f,c)]}),p.addCustomComputeBudget(l),p.addTipInstruction(m),p.versionBuild({txVersion:u})}async claimAllPlatformFee({programId:e=le,authProgramId:t,platformId:i,platformClaimFeeWallet:r,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c);return t=t!=null?t:Oe(e).publicKey,(await this.scope.connection.getProgramAccounts(e,{filters:[{dataSize:Le.span},{memcmp:{offset:Le.offsetOf("platformId"),bytes:i.toString()}}]})).forEach(m=>{let d=Le.decode(m.account.data);if(d.platformFee.lte(new O(0)))return;let p=Re(this.scope.ownerPubKey,d.mintB,te).publicKey;u.addInstruction({instructions:[Be(this.scope.ownerPubKey,p,this.scope.ownerPubKey,d.mintB)]}),u.addInstruction({instructions:[wi(e,r,t,m.pubkey,i,d.vaultB,p,d.mintB,te)]})}),u.addTipInstruction(a),o===0?u.sizeCheckBuildV0({computeBudgetConfig:s}):u.sizeCheckBuild({computeBudgetConfig:s})}async createVesting({programId:e=le,poolId:t,beneficiary:i,shareAmount:r,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),l=await this.getRpcPoolInfo({poolId:t});r.add(l.vestingSchedule.totalAllocatedShare).gt(l.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount");let m=xt(e,t,i).publicKey;return u.addInstruction({instructions:[Pi(e,this.scope.ownerPubKey,i,t,m,r)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:o})}async createMultipleVesting({programId:e=le,poolId:t,beneficiaryList:i,txVersion:r,computeBudgetConfig:o,feePayer:s}){let a=this.createTxBuilder(s);i.length===0&&this.logAndCreateError("beneficiaryList is null");let c=await this.getRpcPoolInfo({poolId:t});return i.reduce((l,m)=>l.add(m.shareAmount),c.vestingSchedule.totalAllocatedShare).gt(c.vestingSchedule.totalLockedAmount)&&this.logAndCreateError("share amount exceed total locked amount"),i.forEach(l=>{let m=xt(e,t,l.wallet).publicKey;a.addInstruction({instructions:[Pi(e,this.scope.ownerPubKey,l.wallet,t,m,l.shareAmount)]})}),r===0?a.sizeCheckBuildV0({computeBudgetConfig:o}):a.sizeCheckBuild({computeBudgetConfig:o})}async claimVesting({programId:e=le,poolId:t,poolInfo:i,vestingRecord:r,txVersion:o,computeBudgetConfig:s,txTipConfig:a,feePayer:c}){let u=this.createTxBuilder(c),l=Oe(e).publicKey,m=r||xt(e,t,this.scope.ownerPubKey).publicKey,d=i;if(!d){let f=await this.scope.connection.getAccountInfo(t);f||this.logAndCreateError("pool not found"),d=Le.decode(f.data)}let p=Re(this.scope.ownerPubKey,d.mintA,te).publicKey;return u.addInstruction({instructions:[Be(this.scope.ownerPubKey,p,this.scope.ownerPubKey,d.mintA)]}),u.addInstruction({instructions:[gi(e,this.scope.ownerPubKey,l,t,m,p,d.vaultA,d.mintA,te)]}),u.addCustomComputeBudget(s),u.addTipInstruction(a),u.versionBuild({txVersion:o})}async claimMultiVesting({programId:e=le,poolIdList:t,poolsInfo:i={},vestingRecords:r={},txVersion:o,computeBudgetConfig:s,feePayer:a}){let c=this.createTxBuilder(a),u=z({},i),l=Oe(e).publicKey,m=t.filter(d=>!u[d.toBase58()]);if(m.length){let d=await this.getRpcPoolsInfo({poolIdList:m});u=z(z({},u),d.poolInfoMap)}return t.forEach(d=>{let p=d.toBase58(),f=u[p];f||this.logAndCreateError(`pool info not found: ${p}`);let b=r[p]||xt(e,d,this.scope.ownerPubKey).publicKey,g=Re(this.scope.ownerPubKey,f.mintA,te).publicKey;c.addInstruction({instructions:[Be(this.scope.ownerPubKey,g,this.scope.ownerPubKey,f.mintA)]}),c.addInstruction({instructions:[gi(e,this.scope.ownerPubKey,l,d,b,g,f.vaultA,f.mintA,te)]})}),o===0?c.sizeCheckBuildV0({computeBudgetConfig:s}):c.sizeCheckBuild({computeBudgetConfig:s})}async claimVaultPlatformFee({programId:e=le,platformId:t,mintB:i,mintBProgram:r=te,claimFeeWallet:o,txVersion:s,computeBudgetConfig:a,txTipConfig:c,feePayer:u}){let l=this.createTxBuilder(u),m=ct(e,t,i).publicKey,d=fi(e).publicKey,p=this.scope.account.getAssociatedTokenAccount(i,r);return l.addInstruction({instructions:[Be(this.scope.ownerPubKey,p,this.scope.ownerPubKey,i,r),Ai(e,t,o!=null?o:this.scope.ownerPubKey,d,m,p,i,r)]}),l.addCustomComputeBudget(a),l.addTipInstruction(c),l.versionBuild({txVersion:s})}async claimMultipleVaultPlatformFee({programId:e=le,platformList:t,unwrapSol:i=!0,txVersion:r,computeBudgetConfig:o,feePayer:s,associatedOnly:a=!0,checkCreateATAOwner:c=!1}){let u=this.createTxBuilder(s),l={};return t.forEach(async m=>{var g,k;let d=fi(e).publicKey,p=ct(e,m.id,m.mintB).publicKey,f=m.mintB.equals(Ue)&&i,b=l[m.mintB.toBase58()];if(!b){let{account:w,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({mint:m.mintB,owner:this.scope.ownerPubKey,createInfo:f?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!f,notUseTokenAccount:f,associatedOnly:f?!1:a,checkCreateATAOwner:c});w&&(b=w),u.addInstruction(h||{}),b===void 0&&this.logAndCreateError(`cannot found platform ${m.id.toBase58()} mintB(${m.mintB.toBase58()}) token accounts`,"tokenAccounts",this.scope.account.tokenAccounts)}u.addInstruction({instructions:[Ai(e,m.id,(g=m.claimFeeWallet)!=null?g:this.scope.ownerPubKey,p,d,b,m.mintB,(k=m.mintBProgram)!=null?k:te)]})}),r===0?u.sizeCheckBuildV0({computeBudgetConfig:o}):u.sizeCheckBuild({computeBudgetConfig:o})}async claimCreatorFee({programId:e=le,mintB:t,mintBProgram:i=te,txVersion:r,computeBudgetConfig:o,txTipConfig:s,feePayer:a}){let c=this.createTxBuilder(a),u=lt(e,this.scope.ownerPubKey,t).publicKey,l=bi(e).publicKey,m=this.scope.account.getAssociatedTokenAccount(t,i);return c.addInstruction({instructions:[Be(this.scope.ownerPubKey,m,this.scope.ownerPubKey,t,i),Ti(e,this.scope.ownerPubKey,l,u,m,t,i)]}),c.addCustomComputeBudget(o),c.addTipInstruction(s),c.versionBuild({txVersion:r})}async claimMultipleCreatorFee({programId:e=le,mintBList:t,txVersion:i,computeBudgetConfig:r,feePayer:o}){let s=this.createTxBuilder(o);return t.forEach(a=>{var p;let c=a.pubKey,u=(p=a.programId)!=null?p:te,l=lt(e,this.scope.ownerPubKey,c).publicKey,m=bi(e).publicKey,d=this.scope.account.getAssociatedTokenAccount(c,u);s.addInstruction({instructions:[Be(this.scope.ownerPubKey,d,this.scope.ownerPubKey,c,u),Ti(e,this.scope.ownerPubKey,m,l,d,c,u)]})}),i==0?s.sizeCheckBuildV0({computeBudgetConfig:r}):s.sizeCheckBuild({computeBudgetConfig:r})}async getRpcPoolInfo({poolId:e}){return(await this.getRpcPoolsInfo({poolIdList:[e]})).poolInfoMap[e.toBase58()]}async getRpcPoolsInfo({poolIdList:e,config:t}){let i=await _e(this.scope.connection,e.map(c=>({pubkey:c})),t),r={},o=[];for(let c=0;c<e.length;c++){let u=i[c];if(u===null||!u.accountInfo)throw Error("fetch pool info error: "+e[c].toBase58());let l=Le.decode(u.accountInfo.data);r[e[c].toBase58()]=Q(z({},l),{poolId:e[c],programId:u.accountInfo.owner}),o.push(l.configId)}let s=await _e(this.scope.connection,o.map(c=>({pubkey:c})),t),a={};for(let c=0;c<o.length;c++){let u=s[c];if(u===null||!u.accountInfo)throw Error("fetch config info error: "+o[c].toBase58());let l=Je.decode(u.accountInfo.data);a[o[c].toBase58()]=Q(z({},l),{configId:u.accountInfo.owner})}return{poolInfoMap:Object.keys(r).reduce((c,u)=>Q(z({},c),{[u]:Q(z({},r[u]),{configInfo:a[r[u].configId.toBase58()]})}),{})}}};export{An as LaunchpadPoolInitParam,ki as default,Ng as usdMintBSet};
//# sourceMappingURL=launchpad.mjs.map